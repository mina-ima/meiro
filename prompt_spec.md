
# MEIRO v1 é–‹ç™ºä»•æ§˜ï¼ˆDev-Readyï¼‰

## 1. ã‚¹ã‚³ãƒ¼ãƒ—/ã‚´ãƒ¼ãƒ«

* PCãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éå¯¾ç§°å¯¾æˆ¦ï¼š**ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆä¿¯ç°ç·¨é›†ï¼‰ vs ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆä¸€äººç§°æ¢ç´¢ï¼‰**ã€‚
* **1å¯¾1**, è¦³æˆ¦ãªã—ã€‚**React + Phaser**ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€**Cloudflare Workers + Durable Objectsï¼ˆDOï¼‰**ã§ã‚µãƒ¼ãƒã€‚
* **ã‚µãƒ¼ãƒæ¨©å¨å‹**ã€**20Hz**ã‚µãƒ¼ãƒTickã€**30fps**æç”»ä¸Šé™ã€**WebSocketå¸¸æ™‚æ¥ç¶š**ã€‚
* ã‚²ãƒ¼ãƒ é€²è¡Œãƒ»ãƒ«ãƒ¼ãƒ«ãƒ»æ•°å€¤ãƒ»ãƒ•ã‚§ãƒ¼ã‚ºãƒ»è³‡æºãƒ»ç¦æ­¢ã‚¨ãƒªã‚¢ãƒ»çµ‚äº†æ¡ä»¶ã¯**åŸä»•æ§˜ã«å®Œå…¨æº–æ‹ **ã€‚

---

## 2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹/æˆåŠŸæ¡ä»¶

* **ãƒ­ãƒ“ãƒ¼ä½œæˆâ†’ã‚³ãƒ¼ãƒ‰å…±æœ‰â†’å…¥å®¤â†’60ç§’æº–å‚™â†’æ¢ç´¢â†’çµ‚äº†/åˆ¤å®šâ†’å†æˆ¦**ãŒ**2åˆ†ä»¥å†…ã®æ“ä½œå­¦ç¿’**ã§æˆç«‹ã€‚
* **ä½“æ„Ÿé…å»¶100msä»¥ä¸‹**ã€é€šä¿¡æ–­å¾©å¸°ã¯**60ç§’çŒ¶äºˆ**ãƒãƒ¼ã‚ºé‹ç”¨ã€‚

---

## 3. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### 3.1 å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
[Browser: React+Phaser]  <--WS-->  [CF Workers Router]  --> [Durable Object: RoomInstance]
         |                                    |
   CF Pages / Vercel(é™çš„)             KV(çŸ­æœŸãƒ¡ã‚¿)/R2(å°†æ¥)
```

* **1ãƒ«ãƒ¼ãƒ =1 DO**ã€‚å¼·æ•´åˆã§ãƒ«ãƒ¼ãƒ çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†ã€‚
* é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã¯ Cloudflare Pages ã¾ãŸã¯ Vercel ã‚’æƒ³å®šã€‚ã©ã¡ã‚‰ã®å ´åˆã‚‚ WebSocket ã¯ Cloudflare Workers ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

### 3.2 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ§‹æˆï¼ˆReact + Phaserï¼‰

* `App`ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°/ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼‰
* `Lobby`ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ /å…¥å®¤ï¼‰
* `GameRoot`

  * `OwnerView`ï¼ˆä¿¯ç°UI, ã‚ºãƒ¼ãƒ /ãƒ‘ãƒ³, ç·¨é›†ãƒ„ãƒ¼ãƒ«ï¼‰
  * `PlayerView`ï¼ˆãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆé¢¨ä¸€äººç§°ï¼‰
  * `HUD`ï¼ˆå…±é€š/å½¹å‰²åˆ¥ï¼‰
* `NetClient`ï¼ˆWSæ¥ç¶šãƒ»å†æ¥ç¶šãƒ»RTTæ¸¬å®šï¼‰
* `SoundManager`ï¼ˆSEã®ã¿ï¼‰
* `Replay/Recording`ï¼šv1æœªå®Ÿè£…ã€‚

### 3.3 ã‚µãƒ¼ãƒæ§‹æˆï¼ˆWorkers + DOï¼‰

* `router`ï¼šWSã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰/ãƒ«ãƒ¼ãƒ ç™ºè¡Œ/å…¥å®¤æ¤œè¨¼
* `RoomDO`ï¼š**ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—(20Hz)**ã€çŠ¶æ…‹æ©Ÿæ¢°ã€æ¨©å¨åˆ¤å®šã€ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
  * ãƒ«ãƒ¼ãƒ ç”Ÿæˆ/ãƒ­ãƒ“ãƒ¼ãƒªã‚»ãƒƒãƒˆ/å†æˆ¦æ™‚ã« `generateMaze` ã§æ–°ã—ã„è¿·è·¯(start/goal)ã‚’ç¢ºå®šã—ã€`goalCell` ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ãƒãƒ¼ãƒ³ã‚’å†åˆæœŸåŒ–
* `match`ï¼šã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆ6æ¡ Base32é¢¨, O/I/1/0é™¤å¤–ï¼‰
* `maze`ï¼šç”Ÿæˆï¼ˆæ£’å€’ã—/ç©´æ˜ã‚Šï¼‰ã€**æœ€çŸ­çµŒè·¯ä¸‹é™ä¿è¨¼**ã¨**çµŒè·¯ç¶­æŒBFS**
* `rules`ï¼šãƒã‚¤ãƒ³ãƒˆ/ã‚´ãƒ¼ãƒ«ãƒœãƒ¼ãƒŠã‚¹/ç½ /è³‡æº/ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³è¨ˆç®—
* `validation`ï¼šç·¨é›†ç¦æ­¢/é‡ãªã‚Š/è³‡æº/çµŒè·¯ä¿è¨¼
* `disconnect`ï¼š60ç§’ãƒãƒ¼ã‚ºâ†’åˆ¤å®šç¢ºå®šå‡¦ç†

---

## 4. ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ©Ÿæ¢°

```
[CREATED]->[LOBBY]->[COUNTDOWN(3s)]->[PREP(60s:40/5/15)]->[EXPLORE(limit 5..10m)]
   |                                                                               |
   +-------------------------------[TIMEOUT or WIN]--------------------------------+
```

* ãƒ­ãƒ“ãƒ¼å¾…æ©Ÿ5åˆ†ã§è‡ªå‹•è§£æ•£ã€‚æº–å‚™ã¯**(ãƒã‚¤ãƒ³ãƒˆ40sâ†’ç½ 5sâ†’äºˆæ¸¬15s)** å›ºå®šã€‚å†æˆ¦ã¯**åŒéƒ¨å±‹/å½¹å‰²50-50**ã€‚
* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹ã¯**ãƒ­ãƒ“ãƒ¼ä¸­ã®ã‚ªãƒ¼ãƒŠãƒ¼ã®ã¿**ãŒ `O_START` ã‚’é€ä¿¡ã—ã¦å®Ÿè¡Œã™ã‚‹ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æœªå‚åŠ ã‚„æ—¢ã«é€²è¡Œä¸­ã®å ´åˆã¯ `START_WAITING_FOR_PLAYER` / `START_UNAVAILABLE` ã‚’å³æ™‚è¿”ã™ã€‚
* DO å†…ã® `phaseEndsAt` ã¯**å¸¸ã«ãƒŸãƒªç§’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(number)**ã§ç®¡ç†ã—ã€`state.storage.setAlarm()` ã«æ¸¡ã™å‰ã« `Number.isFinite` ã¨ `Invalid Date` ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚ä¸æ­£å€¤ï¼ˆ`null`/`NaN`/æ–‡å­—åˆ—ãªã©ï¼‰ã¯ `console.warn` ã‚’å‡ºã—ã¦ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®šã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€`server/tests/phase-alarm.test.ts` ã§ DoD ã‚’æ‹…ä¿ã™ã‚‹ã€‚

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆæ¨©å¨ã‚µãƒ¼ãƒå†…ï¼‰

```ts
type Room = {
  roomId: string; status: 'CREATED'|'LOBBY'|'COUNTDOWN'|'PREP'|'EXPLORE'|'RESULT';
  seed: string; sizeL: 20|40; createdAt: number; timeoutAt?: number;
  owner?: ConnRef; player?: ConnRef;
  rules: Rules; // requiredRate=0.65, goalBonusRate=0.2, trapSlowRate=0.4, etc.
};

type Maze = {
  sizeL: 20|40;
  cells: Uint8Array;        // bitmaskï¼ˆå£/é€šè·¯ï¼‰
  walls: Set<Edge>;         // edge=(x,y,dir) dirâˆˆN,E,S,W
  start: Vec2; goal: Vec2;
};

type OwnerState = {
  wallStock: number; wallRemoveLeft: 0|1; trapRights: number;
  traps: Trap[]; predictSites: Vec2[]; cdUntil: number;
  points: PointItem[]; pointLimit: number; pointTotal: number;
};

type PlayerState = {
  pos: {x:number,y:number,angle:number};
  vx:number; vy:number; slowedUntil:number; score:number; previewSeed:string;
  goalBonusAwarded:boolean;
};

type Rules = {
  pointLowerBound:number; pointCountUpper:number;
  requiredRate:number; goalBonusRate:number;
  trapSlowRate:number; trapDurMs:number; // limit/5
};

type PointItem = {x:number,y:number,value:1|3|5};
```

* ä»•æ§˜ã®åç§°/ä¿‚æ•°ã¯ãã®ã¾ã¾æ¡ç”¨ã€‚

---

## 6. é€šä¿¡ä»•æ§˜ï¼ˆWebSocket, JSON Linesï¼‰

### 6.1 ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³

* `client->router`ï¼š`/ws?room=ABC123&role=owner|player&nick=foo`
* ãƒ«ãƒ¼ã‚¿ãŒè©²å½“`RoomDO`ã¸ãƒ—ãƒ­ã‚­ã‚·ã€‚**DOãŒå”¯ä¸€ã®çœŸå®Ÿ**ã€‚
* ãƒ«ãƒ¼ã‚¿â†”DOãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ï¼š`/ws` ãƒãƒ³ãƒ‰ãƒ©ã¯ `Upgrade: websocket` ã¨ GET ã‚’æ¤œè¨¼ã—ãŸã†ãˆã§ã€**å…ƒã® Request ã‚’ãã®ã¾ã¾ Durable Object stub ã¸ `stub.fetch(request)` ã§å§”è­²ã™ã‚‹ã€‚** Worker å´ã§ã¯ `WebSocketPair` ã‚’ç”Ÿæˆã›ãšã€ãƒ­ã‚° (`WS fetch /ws`) ã‚’æ®‹ã™ã®ã¿ã€‚DO å´ã¯ `url.pathname.endsWith("/ws")`ï¼ˆ`/<DurableObjectId>/ws` å«ã‚€ï¼‰ã‚’æ¤œå‡ºã—ãŸã‚‰ `WebSocketPair` ã‚’ç”Ÿæˆã—ã€`server.accept()` â†’ `registerSocket` â†’ `DEBUG_CONNECTED` â†’ `STATE(full)` ã®é †ã§é€ä¿¡ã™ã‚‹ã€‚join å¤±æ•—æ™‚ã¯ JSON ã‚¨ãƒ©ãƒ¼ (409/410/500) ã‚’ç›´æ¥è¿”ã—ã€Worker ã¯ Response ã‚’ãã®ã¾ã¾ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”å´ã™ã‚‹ã€‚DoD: `server/tests/websocket-handler.test.ts` ã§ Request ã‚’ãã®ã¾ã¾ stub.fetch ã«æ¸¡ã—ã€ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä¸¸ã”ã¨è¿”ã™ã“ã¨ã‚’æ¤œè¨¼ã—ã€`server/tests/room-session-websocket.test.ts` ã§ DO ãŒ `/ws` ã¨ `/<id>/ws` ã® Upgrade ã«å¯¾ã—ã¦ `DEBUG_CONNECTED` / `STATE` ã‚’é…ä¿¡ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã€‚
* DO ã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼ã¯ router å´ã§æ¤œè¨¼æ¸ˆã¿ã® `room` å€¤ã‚’ãã®ã¾ã¾ä¿¡é ¼ã—ã€**6æ¡Base32ã§ã¯ãªã„ DO IDï¼ˆ`/<DurableObjectId>/ws` çµŒç”±ï¼‰ã§ã‚ã£ã¦ã‚‚è‡ªèº«ã® DO ID ã¨ä¸€è‡´ã™ã‚Œã°å—ã‘å…¥ã‚Œã‚‹**ã€‚JSON body ã«ã‚ˆã‚‹ `roomId` æŒ‡å®šã‚‚åŒæ§˜ã«æ‰±ã„ã€`server/tests/disconnect-timeout.test.ts` / `server/tests/prediction-bonus.test.ts` ãªã©ã®å†æ¥ç¶šã‚·ãƒŠãƒªã‚ªã§æ‹…ä¿ã™ã‚‹ã€‚
* Cloudflare ã® DO ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ `request.url.pathname` ã« `/<DurableObjectId>/...` ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒä»˜ä¸ã•ã‚Œã‚‹ãŸã‚ã€`RoomDO.fetch()` ã§ã¯ `endsWith("/ws")` / `endsWith("/rematch")` ã®ã‚ˆã†ã«æœ«å°¾ä¸€è‡´ã§åˆ¤å®šã—ã€Upgrade è¦æ±‚ãŒ GET ã‹ã¤ `Upgrade: websocket` ã®ã¨ãã®ã¿ 101 ã‚’è¿”ã™ã€‚

### 6.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹

**å…±é€šï¼š**

```json
// å—ä¿¡: ã‚µãƒ¼ãƒâ†’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
{ "t":"STATE", "s": <compact state snapshot> }                 // å‘¨æœŸé…ä¿¡(20Hz) or é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆæ™‚
{ "t":"EV", "ev":"COUNTDOWN" | "PREP" | "EXPLORE" | "RESULT", "at": 172..., "payload":{...} }
{ "t":"ERR", "code": "ROOM_FULL|INVALID_NAME|DENY_EDIT|NO_PATH|COOLDOWN|..." , "msg": "..." }
// é€ä¿¡: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆâ†’ã‚µãƒ¼ãƒ
{ "t":"PING", "id":123 }  â†’ { "t":"PONG", "id":123, "svt":172... }
```

**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼š**

```json
{ "t":"P_INPUT", "yaw": 0.12, "fwd": 1|-1|0, "ts": 172... } // A/Då›è»¢, W/Så‰å¾Œ
```

**ã‚ªãƒ¼ãƒŠãƒ¼ï¼š**

```json
{ "t":"O_EDIT", "op":"ADD_WALL", "edge": {"x":10,"y":5,"dir":"E"} }
{ "t":"O_EDIT", "op":"DEL_WALL", "edge": {"x":10,"y":5,"dir":"E"} }   // 1å›ã®ã¿
{ "t":"O_EDIT", "op":"PLACE_TRAP", "pos":{"x":12,"y":7} }
{ "t":"O_EDIT", "op":"PLACE_POINT", "cell":{"x":8,"y":9}, "value":1|3|5 }
{ "t":"O_MRK",  "pos":{"x":11,"y":9} }                                // äºˆæ¸¬åœ°ç‚¹(æº–å‚™15s)
{ "t":"O_CONFIRM", "target":"<opaque-id>" }                            // 2åº¦æŠ¼ã—ç¢ºå®š
{ "t":"O_CANCEL",  "target":"<opaque-id>" }
{ "t":"O_START", "mazeSize":20|40 }                                    // 20Ã—20 / 40Ã—40 ã‚’æŒ‡å®šã—ã¦ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
```

* **æ¥ç¶šç›´å¾Œãƒ‡ãƒãƒƒã‚°**: WebSocket æ¥ç¶šãŒæˆç«‹ã—ãŸç¬é–“ã« DO ã‹ã‚‰ `DEBUG_CONNECTED` ã‚’1åº¦ã ã‘é€ä¿¡ã—ã€`roomId`/`role`/`sessionId` ã‚’é€šçŸ¥ã™ã‚‹ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã® WS Messages ã«æœ€ä½1ä»¶è¡¨ç¤ºã•ã›ã€`wrangler tail` ã§ã‚‚ `WS fetch /ws` â†’ `DO connected` â†’ `send DEBUG_CONNECTED` â†’ `send STATE` ã®ãƒ­ã‚°ã‚’å¿…ãšæ®‹ã™ã€‚
* `O_START` ã¯å—ä¿¡æ™‚ã«æŒ‡å®šã•ã‚ŒãŸ `mazeSize` ã‚’ç”¨ã„ã¦ `regenerateMaze` ã¨ `resetOwnerState` ã‚’è¡Œã£ã¦ã‹ã‚‰ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã¸é·ç§»ã™ã‚‹ã€‚è¿·è·¯ã‚µã‚¤ã‚ºã®æ›´æ–°ã¯ `server/tests/manual-start.test.ts` / `server/tests/disconnect-heartbeat.test.ts` ã§æ¤œè¨¼ã™ã‚‹ã€‚
* **åˆæœŸSTATEä¿è¨¼**: ã©ã¡ã‚‰ã®å½¹å‰²ã§ã‚‚åˆå›æ¥ç¶šæ™‚ã¯ `STATE(full:true)` ã‚’å³æ™‚é€ä¿¡ã™ã‚‹ã€‚å­˜åœ¨ã—ãªã„å ´åˆã¯ `createInitialRoomState` ã§ç”Ÿæˆã—ã€`state-broadcast` ãƒ†ã‚¹ãƒˆã§æ‹…ä¿ã™ã‚‹ã€‚
* **è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼**: WebSocket ãƒãƒ³ãƒ‰ãƒ©ã§æœªæ•æ‰ã®ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ `console.error("WS handler error", err)` ã‚’è¨˜éŒ²ã—ã€`{ type:"ERROR", code:"INTERNAL_ERROR" }` ã‚’é€ã£ã¦ã‹ã‚‰ `socket.close(1011, "internal error")` ã§çµ‚äº†ã™ã‚‹ã€‚

### 6.3 å·®åˆ†/é »åº¦

* **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ**ï¼šPhaseé·ç§»/ç·¨é›†ç¢ºå®šï¼ˆ`O_CONFIRM`ï¼‰æ™‚ã¯å…¨é‡ã€å°åˆ»ã¿æ›´æ–°ã¯**ä½ç½®/ã‚¹ã‚³ã‚¢ç­‰ã®å·®åˆ†**ã€‚
* **ã‚µãƒ¼ãƒâ†’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé€ä¿¡**ã¯**20Hz**ä¸Šé™ã®é€ä¿¡ã‚­ãƒ¥ãƒ¼ã§æ’å‡ºï¼ˆé€šå¸¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯p95ã§â‰¤2KBã€è¿·è·¯ã‚’å«ã‚€åˆå›ãƒ•ãƒ«STATEã¯æœ€å¤§ç´„20KBã‚’è¨±å®¹ï¼‰ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè£œé–“è¡¨ç¤ºã€‚
* STATEãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å†…ã®åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã¯ `[x,y]`ï¼ˆç‚¹/ç½ /äºˆæ¸¬ï¼‰ã‚„ `[x,y,value]`ï¼ˆãƒã‚¤ãƒ³ãƒˆï¼‰å½¢å¼ã«åœ§ç¸®ã—ã€40Ã—40è¿·è·¯ã‚’å«ã‚€ãƒ•ãƒ«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã‚‚ç´„20KBä»¥å†…ã«åã‚ã‚‹ã€‚
* å·®åˆ†STATEã¯é€ä¿¡ã‚­ãƒ¥ãƒ¼ã§æœ€æ–°ã®ã¿ä¿æŒã—ã€å¤ã„å·®åˆ†ã¯ç ´æ£„ã—ã¦**é…å»¶ã‚’100msä»¥ä¸‹ã«æŠ‘ãˆã‚‹**ã€‚
* STATEã® `owner` ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«ã¯ `wallStock`/`wallRemoveLeft`/`trapCharges` ã«åŠ ãˆã¦ `editCooldownDuration`ï¼ˆmsï¼‰ã¨ `forbiddenDistance`ï¼ˆãƒãƒ³ãƒãƒƒã‚¿ãƒ³è·é›¢ï¼‰ãŒå«ã¾ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆHUDã§ãã®ã¾ã¾è¡¨ç¤ºã™ã‚‹ï¼ˆ`server/tests/state-sync.test.ts` / `client/tests/AppOwnerForbiddenDistance.test.tsx`ï¼‰ã€‚

---

## 7. ãƒ­ã‚¸ãƒƒã‚¯è©³ç´°

### 7.1 è¿·è·¯ç”Ÿæˆã¨æœ€çŸ­è·¯åˆ¶ç´„

* ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼š**æ£’å€’ã—æ³•/ç©´æ˜ã‚Šæ³•**ã€‚ç”Ÿæˆå¾Œã«**æœ€çŸ­è·¯é•· â‰¥ 4Ã—L** ã‚’æº€ãŸã™ã¾ã§å†è©¦è¡Œï¼ˆK=4ï¼‰ã€‚
* `start/goal`ã¯è¿·è·¯ç›´å¾„ã®è‘‰ãƒãƒ¼ãƒ‰ã‹ã‚‰é¸ã³ã€ååˆ†è·é›¢ã‚’å–ã£ã¦ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ã€‚ã‚´ãƒ¼ãƒ«ã¯å¸¸ã«1ã¤ã€‚

### 7.2 çµŒè·¯ç¶­æŒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

* ç·¨é›†æ™‚ï¼š**BFS**ã§`playerâ†’goal`ã®åˆ°é”è·¯ãŒ**æœ€ä½1æœ¬**ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚**ãªã‘ã‚Œã°å³ä¸è¨±å¯**ã€‚

### 7.3 ç‰©ç†/ç§»å‹•

* **å›è»¢**ï¼š360Â°/ç§’ã€‚**ç§»å‹•**ï¼š2.0ãƒã‚¹/ç§’ã€‚åŠå¾„0.35ãƒã‚¹ã®å††ã‚³ãƒªã‚¸ãƒ§ãƒ³ã€‚è§’è¡çªã¯**ã‚¹ãƒ©ã‚¤ãƒ‰è£œæ­£**ã€‚
* ã‚µãƒ¼ãƒãƒ¼Tickã¯å®Ÿæ™‚é–“ã®çµŒéã‚’ç”¨ã„ã¦ç©åˆ†ã—ã€é…å»¶ãŒç™ºç”Ÿã—ã¦ã‚‚ç§»å‹•/å›è»¢ãŒä¸Šé™å€¤ã‚’è¶…éã—ãªã„ã‚ˆã†å¼·åˆ¶ã€‚
* ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆè¦–ç•Œï¼šFOV 90Â°ã€åˆ°é”4ãƒã‚¹ï¼ˆ4ãƒã‚¹ç›®æ¸›å…‰ï¼‰ï¼‹æœ€å¤§90æœ¬ã€‚é®è”½ã‚ã‚Šã€‚

### 7.4 ç½ 

* é€šè·¯ä¸­å¿ƒã®ã¿ã€‚è¸ã‚€ã¨**é€Ÿåº¦40%**ã€**æ®‹ã‚Šåˆ¶é™æ™‚é–“ã®1/5**æŒç¶šï¼ˆé€£ç¶šè¸ã¿ã§å»¶é•·ï¼‰ã€‚åŒæ™‚2å€‹ã¾ã§ã€‚
* æ¤œè¨¼: `server/tests/trap-effects.test.ts`ï¼ˆé€Ÿåº¦ä½ä¸‹ãƒ»åŒæ™‚è¨­ç½®æ•°ï¼‰ã€`server/tests/trap-apply.test.ts`ï¼ˆæŒç¶šæ™‚é–“å»¶é•·ï¼‰

### 7.5 å£è³‡æºã¨ç·¨é›†

* å˜ä½ã¯**1è¾º=1æœ¬**ã€‚åˆæœŸæœ¬æ•°ï¼ˆ20Ã—20:48æœ¬ / 40Ã—40:140æœ¬ï¼‰ã¯RoomDOç”Ÿæˆæ™‚ã« `owner.wallStock` ã¸å‰²ã‚Šå½“ã¦ã‚‹ã€‚
* å£å‰Šé™¤æ¨©ã¯ `owner.wallRemoveLeft` ã§ç®¡ç†ã—ã€**1å›ã®ã¿**ä½¿ç”¨å¯ï¼ˆä½¿ç”¨æ™‚ã¯å£æœ¬æ•°+1ã§è¿”å´ï¼‰ã€‚
* ç½ æ¨©åˆ©ã¯ `owner.trapCharges` ã¨ã—ã¦ã‚µãƒ¼ãƒãŒä¿æŒã—ã€**åˆæœŸå€¤=1**ï¼ˆæº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºå³æ™‚è¨­ç½®å¯ï¼‰ã€‚æ®‹æ•°0æ™‚ã¯ `PLACE_TRAP` ã‚’æ‹’å¦ã€‚
* **äºˆæ¸¬åœ°ç‚¹ãƒœãƒ¼ãƒŠã‚¹**ï¼šé€šéã”ã¨ã«**å£+1(70%) or ç½ æ¨©åˆ©+1(30%)**ã€‚ï¼ˆRoomDOå®Ÿè£…æ¸ˆ / server/tests/prediction-bonus.test.tsï¼‰
  * ãƒãƒƒãƒæŠ½é¸ã§é•·æœŸçš„ã«70/30Â±5%ã¸åæŸã•ã›ã‚‹ï¼ˆserver/tests/prediction-bonus-ratio.test.tsï¼‰
* **ç¦æ­¢ã‚¨ãƒªã‚¢**ï¼šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼**ãƒãƒ³ãƒãƒƒã‚¿ãƒ³è·é›¢2**ä»¥å†…ç·¨é›†ä¸å¯ã€‚è·é›¢åˆ¤å®šã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åº§æ¨™ã‚’ã‚»ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¸åˆ‡ã‚Šæ¨ã¦ã¦ç®—å‡ºã—ã€å¢ƒç•Œä»˜è¿‘ã§ã‚‚èª¤æ¤œçŸ¥ã—ãªã„ã€‚
* å£å‰Šé™¤ã¯**æ—¢å­˜ã®å£ã‚»ãƒ«**ã®ã¿è¨±å¯ã€‚å­˜åœ¨ã—ãªã„å£ã‚’æŒ‡å®šã—ãŸå ´åˆã¯ `DENY_EDIT` ã§æ‹’å¦ã—ã€å‰Šé™¤æ¨©/åœ¨åº«ã¯å¤‰åŒ–ã—ãªã„ã€‚

### 7.6 ãƒã‚¤ãƒ³ãƒˆ/å‹æ•—

* é…ç½®ã¯æº–å‚™40ç§’ã®ã¿ã€‚**åˆè¨ˆä¸‹é™**ã¨**å€‹æ•°ä¸Šé™**é©ç”¨ã€ä¸‹é™æœªé”ã¯**ä¸è¶³åˆ†ã‚’ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸãƒã‚¤ãƒ³ãƒˆ**ã«è£œå¡«ï¼ˆä¸Šé™=è¦å®šâˆ’1ï¼‰ã€‚
  * è£œå¡«ã§ä»˜ä¸ã•ã‚ŒãŸãƒã‚¤ãƒ³ãƒˆé‡ã¯ `pointCompensationAward` ã¨ã—ã¦STATEã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«å«ã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆHUDã§é€šçŸ¥ã™ã‚‹ï¼ˆserver/tests/points-scoring.test.ts / client/tests/PlayerViewCompensationNotice.test.tsxï¼‰ã€‚
* **è¦å®šãƒã‚¤ãƒ³ãƒˆ=ceil(0.65 Ã— åˆè¨ˆé…ç½®ãƒã‚¤ãƒ³ãƒˆ)**ã€ã‚´ãƒ¼ãƒ«ã§**è¦å®šã®1/5åŠ ç‚¹**ã€‚**è¦å®šåˆ°é”ã§å³çµ‚äº†**ã—ã€HUDç›´ä¸‹ã«ã€Œè¦å®šãƒã‚¤ãƒ³ãƒˆé”æˆï¼ã€é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆserver/tests/points-scoring.test.ts / client/tests/PlayerViewTargetCompletion.test.tsxï¼‰ã€‚
  * ã‚µãƒ¼ãƒå´ã¯ `server/src/logic/rules.ts` ã« `requiredScore` ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ç”¨æ„ã—ã€`server/tests/rules.test.ts` ã®å¢ƒç•Œãƒ†ã‚¹ãƒˆã§ä¿‚æ•°ãƒ»åˆ‡ã‚Šä¸Šã’å‡¦ç†ã‚’æ‹…ä¿ã€‚

### 7.7 åˆ‡æ–­

* ã„ãšã‚Œã‹åˆ‡æ–­â†’**å³ãƒãƒ¼ã‚º**ã€‚**60ç§’**å¾©å¸°ãªã‘ã‚Œã°**ä¸åœ¨å´ã®æ•—åŒ—**ï¼ˆåŒæ–¹ä¸åœ¨ã¯ãƒãƒ¼ã‚²ãƒ¼ãƒ ï¼‰ã€‚ï¼ˆ`server/tests/disconnect-timeout.test.ts` / `server/tests/heartbeat-timeout.test.ts` ã§ãƒãƒ¼ã‚ºç¶­æŒã¨ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆç”±æ¥ã®è‡ªå‹•åˆ‡æ–­ã‚’æ¤œè¨¼ï¼‰

---

## 8. UI/UXå®Ÿè£…è¦ç‚¹

### 8.1 ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼

* **ãƒŸãƒ‹ãƒãƒƒãƒ—ãªã—**ã€**ãƒ˜ãƒƒãƒ‰ãƒœãƒ–ãªã—**ã€‚HUDï¼šæ®‹æ™‚é–“ï¼ˆmm:ssã‚¿ã‚¤ãƒãƒ¼ï¼‰ã€ç¾åœ¨ãƒã‚¤ãƒ³ãƒˆ/è¦å®šãƒã‚¤ãƒ³ãƒˆã€ã‚´ãƒ¼ãƒ«åˆ°é”ãƒœãƒ¼ãƒŠã‚¹å€¤ã€é”æˆç‡(%)é€²æ—ãƒãƒ¼ã€‚
* ä¸è¶³è£œå¡«ãŒé©ç”¨ã•ã‚ŒãŸæ¢ç´¢é–‹å§‹æ™‚ã¯HUDã«ã€ŒåˆæœŸãƒã‚¤ãƒ³ãƒˆè£œå¡« +Nã€ã‚’è¡¨ç¤ºã—ã¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸æ˜ç¤ºã™ã‚‹ã€‚
* æº–å‚™ä¸­ã¯**5ç§’ãƒ©ãƒ³ãƒ€ãƒ é€šè·¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ã‚’é€£ç¶šå†ç”Ÿï¼ˆ**å¿…ãšã‚´ãƒ¼ãƒ«ãŒ1å›æ˜ ã‚‹**ï¼‰ã€‚simpleMazePreview ã®ãƒŸãƒ‹ãƒãƒ«SVGï¼‹ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§æ¡ˆå†…ã—ã€`client/tests/PlayerViewPreview.test.tsx` ã¯ prep ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæç”»ã•ã‚Œã‚‹ã‚¹ãƒ¢ãƒ¼ã‚¯ã®ã¿ã€‚
  * è©³ç´°ãªãƒ¬ãƒ³ã‚¬ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚„ `data-*` å±æ€§æ¤œè¨¼ã¯æ’¤å»ƒã—ã€åºŠ/å£/ç©ºã®ç°¡ç´ æ§‹æˆã ã‘ã‚’ç¶­æŒã™ã‚‹ã€‚
* æ¢ç´¢ãƒ•ã‚§ãƒ¼ã‚ºä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ“ãƒ¥ãƒ¼ã¯è¿·è·¯ãƒ‡ãƒ¼ã‚¿ã¨ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆçµæœã‚’åæ˜ ã—ãŸ**ãƒ¬ãƒ³ã‚¬èª¿ã®ä¸€äººç§°æç”»**ã¨ã—ã€é»’èƒŒæ™¯ã®ä¸Šã«å®Ÿéš›ã®å£ãƒ’ãƒƒãƒˆä½ç½®ã¸èµ¤ã„ãƒ–ãƒªãƒƒã‚¯ã‚«ãƒ©ãƒ ã‚’æç”»ã™ã‚‹ã€‚åºŠ/å¤©äº•/å´å£ã¯é è¿‘ã«ã‚ˆã£ã¦æš—åº¦ã‚’å¤‰ãˆãŸãƒ¬ãƒ³ã‚¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åŸ‹ã‚ã€é–‹ã„ã¦ã„ã‚‹æ–¹å‘ã¯ã‚«ãƒ©ãƒ ãŒæ¬ ã‘ã¦é€šè·¯ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆ`client/tests/PlayerViewRaycaster.test.tsx`ï¼‰ã€‚
* Canvasæç”»ãƒ«ãƒ¼ãƒ—ã¯ `useFixedFrameLoop` ã§ `requestAnimationFrame` ã‚’é–“å¼•ãã€30fpsä¸Šé™ã‚’ä¿è¨¼ã™ã‚‹ã€‚
* **åˆ‡æ–­ãƒãƒ¼ã‚ºä¸­**ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼/ã‚ªãƒ¼ãƒŠãƒ¼å…±é€šã§ç”»é¢ä¸­å¤®ã«åŠé€æ˜ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’é‡ã­ã€ã€Œé€šä¿¡ãŒé€”åˆ‡ã‚Œã¦ã„ã¾ã™ã€ã€Œæ®‹ã‚ŠXXç§’ã§ä¸åœ¨å´æ•—åŒ—ã€ã‚’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤ºã™ã‚‹ï¼ˆå¾©å¸°ã§è‡ªå‹•è§£é™¤ï¼‰ã€‚
* æ›´æ–°ãƒ¡ãƒ¢(2025-10-03): start/junction/goal ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®åºŠãƒ»å£ã‚¸ã‚ªãƒ¡ãƒˆãƒªã€ãƒ•ã‚§ãƒ¼ãƒ‰ã€ç©ºè‰²ãƒãƒ¼ã‚¿ãƒ«å æœ‰ç‡ã‚’ä»•æ§˜ã©ãŠã‚Šã«æœ€çµ‚èª¿æ•´ï¼ˆPlayerView.tsx / PlayerViewPreview.test.tsx åæ˜ ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2025-11-24): ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼SVGã‚’ç°¡ç•¥åŒ–ã—ã€PlayerViewPreview.test.tsx ã‚’ã‚¹ãƒ¢ãƒ¼ã‚¯åŒ–ï¼ˆè©³ç´°ã‚¸ã‚ªãƒ¡ãƒˆãƒª/ãƒ‡ãƒ¼ã‚¿å±æ€§æ¤œè¨¼ã‚’å‰Šé™¤ã€simpleMazePreview.tsã¸é›†ç´„ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-03): FancyMazePreview ã® junction ã‚’å·¦å³2ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¨ªé€šè·¯ï¼‹forward=falseæ™‚ã®ã¿å‰å£ã§åå­—è·¯é¢¨ã«èª¿æ•´ã—ã€`client/tests/fancyMazePreview.test.tsx` ã§å›å¸°
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-18): simpleMazePreview ã‚’ã€ŒåºŠ1æšï¼‹å·¦å³å£1æšã€ã®è¼ªéƒ­ã«å›ºå®šã—ã€junction/goals ã§ forward é–‹æ”¾æ™‚ã«å‰å£ã‚’æã‹ãªã„ã“ã¨ã¨åˆ†å²ã®ç‹­ã¾ã‚Šã‚’ `client/tests/simpleMazePreview.test.tsx` ã§å›å¸°æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-19): simpleMazePreview ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’æ¥µè–„ã«ã—ã€junction ã®å·¦å³é–‹å£ã‚’ç©´ã‚ãå£ï¼‹çŸ­ã„æ¨ªå»Šä¸‹ã§è¡¨ç¾ï¼ˆ`client/tests/simpleMazePreview.test.tsx` ã§å›å¸°ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-20): simpleMazePreview ã‚’æ—§ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆé¢¨ã®ä¸€æœ¬é“ãƒ»å˜ä¸€è¼ªéƒ­ã«å¯„ã›ã€å·¦å³é–‹å£ã‚’å››è§’ã„åˆ‡ã‚Šæ¬ ãï¼‹çŸ­ã„æ¨ªå»Šä¸‹ã§æç”»ï¼ˆ`client/tests/simpleMazePreview.test.tsx` å›å¸°ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-03å†èª¿æ•´): FancyMazePreview junction ã®å·¦å³åˆ†å²åºŠã‚’ slice2 åºŠãƒ©ã‚¤ãƒ³ã«æƒãˆã€æ‰‹å‰ã«ã›ã‚Šå‡ºã•ãšå£ç«¯ã‹ã‚‰æ¨ªé€šè·¯ãŒä¼¸ã³ã‚‹ã‚ˆã†å†èª¿æ•´ï¼ˆ`client/tests/fancyMazePreview.test.tsx` æ›´æ–°ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-03ä»•ä¸Šã’): FancyMazePreview junction ã®å·¦å³åˆ†å²2ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã©ã¡ã‚‰ã‚‚ slice2 åºŠãƒ©ã‚¤ãƒ³ã«æ¥ç¶šã—ã€nearå¹…ã¯æ‰‹å‰>å¥¥ãƒ»farå¹…ã‚‚æ®µéšç‹­ã¾ã‚Šã«ã—ã¤ã¤å‰å£ã¯ forward=false ã®ã¿1æšã€`client/tests/fancyMazePreview.test.tsx` ã§æ¥ç¶šä½ç½®ã¨å¥¥è¡Œãé–¢ä¿‚ã‚’æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-21): FancyMazePreview junction ã«å·¦å³ãƒã‚¹ã‚¯ã‚’è¿½åŠ ã—ã€åˆ†å²å¹…ã‚’æ§ãˆã‚ã«ã—ã¦å£å¤–ã‚’æš—è»¢ï¼ˆåºŠãŒæœ¬ç·šã«ä¹—ã‚‰ãšå¤–å´ãŒè¦‹ãˆãªã„ã‚ˆã†èª¿æ•´ã€`client/tests/fancyMazePreview.test.tsx` ã§ãƒã‚¹ã‚¯å­˜åœ¨ã¨åˆ†å²ç¸®å°ã‚’å›å¸°ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-05): FancyMazePreview junction ã®å·¦å³é–‹å£ã« branch-cut ãƒã‚¹ã‚¯ã‚’è¿½åŠ ã—ã€æ¨ªé€šè·¯ã®æ¶ˆå¤±ç‚¹ã‚’å·¦å³å¤–å´ã¸æŒ¯ã£ã¦å¹…ã‚’å¤ªã‚ã«å†è¨­å®šï¼ˆ`client/tests/fancyMazePreview.test.tsx` ã§branch-cutå­˜åœ¨ã¨farOuterã®å´æ–¹ã‚·ãƒ•ãƒˆã‚’æ¤œè¨¼ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-05è¿½è¨˜): FancyMazePreview junction ã§ openings.left/right ã®ã¨ã slice2 å´é¢å£ã‚’æã‹ãšã«é–‹å£ã‚’ãã‚ŠæŠœãã€çª“çŠ¶ã«è¦‹ãˆãªã„ã‚ˆã† `client/tests/fancyMazePreview.test.tsx` ã§ slice2 å£éæç”»ã‚’æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-06): FancyMazePreview junction/goal ã® branch ãƒã‚¹ã‚¯ä¸‹è¾ºã‚’ slice2 åºŠãƒ©ã‚¤ãƒ³ã«æƒãˆã€æ¨ªé€šè·¯ã®åºŠå¹…ãƒ»å´æ–¹æ¶ˆå¤±ç‚¹ã‚’å¼·ã‚ã¦åºŠãŒè¦‹ãˆã‚‹Tå­—è·¯ã«ã—ã€goal ã§ã‚‚åŒã˜åˆ‡ã‚Šæ¬ ãï¼‹æ¨ªé€šè·¯æç”»ã§çµ±ä¸€ï¼ˆ`client/tests/fancyMazePreview.test.tsx` ã§ãƒã‚¹ã‚¯ä½ç½®ã¨goalåˆ†å²ã‚’æ¤œè¨¼ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-07): FancyMazePreview junction/goal ã§ openings.* ãŒ true ã®å´ã ã‘ç´°ã„ branch ãƒã‚¹ã‚¯ã‚’å…¥ã‚Œã€ç©´ã®å†…å´ã‚’åˆ†å²åºŠ+å´å£ã§åŸ‹ã‚ã¦é»’æŠœã‘ã‚’è§£æ¶ˆã€‚éé–‹å£å´ã®å£ã¯ä¿æŒã—ã€åˆ†å²å£ã‚’å¤©äº•ä»˜è¿‘ã¾ã§ä¼¸ã°ã—ã¦çŸ­ã„æ¨ªé€šè·¯æ„Ÿã‚’å¼·èª¿ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-08): FancyMazePreview junction/goal ã®åˆ†å²åºŠã¨ã‚¬ã‚¤ãƒ‰ã‚’ slice2 åºŠãƒ©ã‚¤ãƒ³åŸºæº–ã§å·¦å³90åº¦ã«æŒ¯ã‚Šã€é–‹å£å´ã ã‘ã®ç´°ã„ãƒã‚¹ã‚¯ã«é™å®šã—ã¦é»’å¸¯ã‚’é™¤å»ã€‚éé–‹å£å´ã®å£ã¯è§¦ã‚‰ãšã€æ¨ªé€šè·¯ã®å¤ªã•ã¨å·¦å³å¯¾ç§°æ€§ã‚’ `client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§å›å¸°
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-09): FancyMazePreview junction/goal ã§ slice2 å£1æšå¹…ã®ãƒã‚¹ã‚¯ã ã‘ã‚’é–‹å£å´ã«é‡ã­ã€ç©´ã®å†…å´ã«åºŠ1æšï¼‹å†…å¤–å£ã®Lå­—æ¨ªé€šè·¯ã‚’ã¯ã‚è¾¼ã‚€ã€‚éé–‹å£å´ã®å£ã¯ç„¡å‚·ã®ã¾ã¾ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-04): FancyMazePreview junction/goal ã® slice2 ã‚¢ãƒ³ã‚«ãƒ¼ï¼ˆanchorXLeft/right, anchorY/anchorFarYï¼‰ã§å£1æšã¶ã‚“ã‚’ä¸¸ã”ã¨ãƒã‚¹ã‚¯ã—ã€æ¨ªé€šè·¯ã®åºŠã¨å†…å¤–å£ã‚’ã‚¢ãƒ³ã‚«ãƒ¼æƒãˆã®Lå­—ã§åŸ‹ã‚ã‚‹ã€‚åˆ†å²åºŠã¯ near å¹… > far å¹…ã®ã¾ã¾å·¦å³æ¶ˆå¤±ç‚¹ã¸å¼·ãåæŸã•ã›ã€ãƒã‚¹ã‚¯å¹…=å£å¹…ã‚’ `client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2025-12-08): FancyMazePreview ã®åˆ†å²åºŠ/å£ã‚’é€šè·¯æŠ•å½±é–¢æ•°ã«çµ±ä¸€ã—ã€ã‚¹ãƒ©ã‚¤ã‚¹2åŸºæº–ã§åºŠãŒé€£ç¶šãƒ»å£ãŒæ‰‹å‰ã«é£Ÿã„è¾¼ã¾ãªã„ã‚ˆã†å†èª¿æ•´ï¼ˆ`client/tests/fancyMazePreview.test.tsx` ã§åºŠ/å£ã®é€£ç¶šæ€§ã‚’æ¤œè¨¼ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-10): FancyMazePreview junction/goal ã®æç”»é †ã‚’åºŠâ†’å£â†’åˆ†å²åºŠâ†’åˆ†å²å£â†’å‰å£â†’ãƒã‚¹ã‚¯ã«æ•´ç†ã—ã€åˆ†å²åºŠã‚’4é ‚ç‚¹ã«çµã£ã¦ slice2 åºŠãƒ©ã‚¤ãƒ³ã¨æƒãˆãŸã†ãˆã§å¥¥å£ã‚’ farY ã‹ã‚‰å¤©äº•ã¾ã§ç«‹ã¡ä¸Šã’ã‚‹ã‚ˆã†å†èª¿æ•´ï¼ˆãƒã‚¹ã‚¯ã¯æœ€å¾Œã«é…ç½®ã—ã¤ã¤åˆ†å²ã‚’è¦†ã‚ãªã„ï¼‰ã€‚`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼é †ã¨åº§æ¨™ã‚’å›å¸°
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-11): FancyMazePreview junction/goal ã®åˆ†å²ã‚’ slice2 è§’(anchorX/anchorY)èµ·ç‚¹ã®åºŠ1æšï¼‹å†…å¤–å£2æšã«ç°¡ç´ åŒ–ã—ã€branch ãƒã‚¹ã‚¯/ã‚¬ã‚¤ãƒ‰ã‚’å»ƒæ­¢ã€‚æç”»é †ã‚’åºŠâ†’å£â†’åˆ†å²â†’å‰å£ã«çµ±ä¸€ã—ã€openings å´ã§ã¯ slice2 ã®å´é¢å£ã ã‘ã‚’éè¡¨ç¤ºã«ã—ã¦Lå­—é€šè·¯ã§ç©´ã‚’åŸ‹ã‚ã‚‹ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-12): FancyMazePreview junction ã®åˆ†å²åºŠ near å´ã‚’å¿…ãš slice2 åºŠç¨œç·š(anchorY)ã®è§’(anchorX)ã‹ã‚‰æãå§‹ã‚ã€å†…å´å£ã®èµ·ç‚¹ã‚‚åŒã˜åº§æ¨™ã«æƒãˆã¦ã€Œå¤–ã—ãŸ slice2 å£ã®å¥¥ã‹ã‚‰å£ãŒä¼¸ã³ã‚‹ã€è¦‹ãŸç›®ã‚’å›ºå®šã€‚`client/tests/fancyMazePreview.test.tsx` ã« anchorX ã¨ã®ä¸€è‡´æ¤œè¨¼ã‚’è¿½åŠ 
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-13): FancyMazePreview junction/goal ã®åˆ†å²åºŠ near å´ã‚’ slice2 åºŠç¨œç·š(anchorY)ã¨å®Œå…¨ã«æƒãˆã€å†…å´å£ã®ä¸‹è¾ºã‚‚ anchorX/anchorYâ†’farY ã‚’å…±æœ‰ã—ã¦æœ¬ç·šå£ã¨ã®é£Ÿã„è¾¼ã¿ã‚’è§£æ¶ˆã€‚æç”»é †ã‚’åºŠâ†’å£â†’åˆ†å²åºŠâ†’åˆ†å²å£ã«å›ºå®šã—ã€`client/tests/fancyMazePreview.test.tsx` ã§ anchorY/anchorX ã®ä¸€è‡´ã¨å£èµ·ç‚¹ã‚’å³å¯†ã«æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-14): FancyMazePreview junction/goal ã®é–‹å£å´ã§ slice2 åºŠãƒ©ã‚¤ãƒ³(anchorY)ã¨å†…å´X(anchorX)ã‚’åŸºæº–ã«å´é¢å£1æšã ã‘ã‚’æŠœãã€ãã®ç©´ã‹ã‚‰å¥¥ã¸90åº¦ã«æ›²ãŒã‚‹Lå­—ã®åˆ†å²åºŠï¼‹å†…å¤–å£ã‚’æç”»ã€‚goal ã§ã‚‚åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±æœ‰ã—ã€branch åºŠ/å£ãŒ anchorY/farY ã¨é€£ç¶šã™ã‚‹ã“ã¨ã‚’ `client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§å›å¸°
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-15): FancyMazePreview junction ã‚’å›ºå®šåº§æ¨™ã®Lå­—é€šè·¯ãƒãƒªã‚´ãƒ³æç”»ã«ç½®ãæ›ãˆã€åˆ†å²æœ‰ç„¡ã®ã‚¹ãƒ¢ãƒ¼ã‚¯æ¤œè¨¼ã ã‘ã«ç°¡ç•¥åŒ–ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-20): FancyMazePreview junction ã‚’ renderJunctionCrossView ã«å·®ã—æ›¿ãˆã€ã‚¹ãƒ©ã‚¤ã‚¹éä¾å­˜ã®å›ºå®šåå­—è·¯ï¼ˆãƒ¡ã‚¤ãƒ³åºŠï¼‹å·¦å³å£ï¼‹å·¦å³åˆ†å²åºŠ/å£ï¼‹å¥¥å£ï¼‰ã‚’æç”»ã€‚ãƒ†ã‚¹ãƒˆã¯åˆ†å²æœ‰ç„¡ã¨ä¸»è¦ãƒ‘ãƒ¼ãƒ„ã®å­˜åœ¨ã ã‘ã‚’ã‚¹ãƒ¢ãƒ¼ã‚¯æ¤œè¨¼ã«ç¸®ç´„ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-21): FancyMazePreview junction/goal ã‚’ã‚¹ãƒ©ã‚¤ã‚¹ãƒ™ãƒ¼ã‚¹ã®æç”»ã«æˆ»ã—ã€slice2 anchorX/anchorY ã‹ã‚‰åˆ†å²åºŠã¨å†…å¤–å£ã‚’é–‹å§‹ã€‚æç”»é †ã‚’åºŠâ†’å£â†’åˆ†å²â†’å‰å£ã«çµ±ä¸€ã—ã€`client/tests/fancyMazePreview.test.tsx` ã§ anchorYãƒ»inner wall èµ·ç‚¹ã®ä¸€è‡´ã‚’ç¢ºèª
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-23): FancyMazePreview junction/goal ã®åˆ†å²åºŠ nearInner/nearOuter ã‚’æœ¬ç·š slice2 åºŠè§’ã¨åŒåº§æ¨™ã«å›ºå®šã—ã€å†…å´å£ã®èµ·ç‚¹ã‚‚ nearInner ã¨å…±æœ‰ã€‚openings å´ã® slice2 å£éè¡¨ç¤ºã‚’ä¿ã£ãŸã¾ã¾ã€branch åºŠ/å†…å£ãŒæœ¬ç·šåºŠç¨œç·šã‹ã‚‰é€£ç¶šã—ã¦ä¼¸ã³ã‚‹ã“ã¨ã‚’ `client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§å³å¯†åŒ–
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-24): FancyMazePreview ã® start/junction/goal ã§ VIEW_* å®šæ•°ã«ã‚ˆã‚ŠåºŠé«˜ã•ãƒ»åœ°å¹³ç·šãƒ»åºŠå¹…ã‚’å…±é€šåŒ–ã—ã€junction åˆ†å²ã‚’ãƒ¡ã‚¤ãƒ³åºŠæ‰‹å‰è§’ã‹ã‚‰ç”Ÿãˆã‚‹å›ºå®šåº§æ¨™ã®Lå­—åºŠï¼‹å†…å¤–å£ã§å†æ§‹æˆã€‚æç”»é †ã‚’åºŠâ†’å£â†’åˆ†å²åºŠâ†’åˆ†å²å£â†’å‰å£ã«å›ºå®šã—ã€data-role ã‚’ä»˜ä¸ã—ãŸã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã§åˆ†å²ãƒ‘ãƒ¼ãƒ„ã®å­˜åœ¨ã‚’æ¤œè¨¼ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰ã€‚
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-25): FancyMazePreview junction/goal ã®åˆ†å²åºŠã‚’ slice2 ã‚¢ãƒ³ã‚«ãƒ¼ç¶­æŒã®ã¾ã¾å¥¥è¡Œãã¨å´æ–¹æ¶ˆå¤±ç‚¹ã‚’å¼·åŒ–ã—ã€farOuter ãŒæ‰‹å‰ã‚ˆã‚Šå¤–å´ã‹ã¤é«˜ã„ä½ç½®ã¸é€ƒã’ã‚‹å°å½¢ã«å†è¨­è¨ˆã€‚BRANCH_* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ•´ç†ã—ã€`client/tests/fancyMazePreview.test.tsx` ã§ farY å·®åˆ†ã¨å´æ–¹ã‚·ãƒ•ãƒˆã‚’æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-26): FancyMazePreview junction/goal ã® BRANCH_* ã‚’æ§ãˆã‚ã«æˆ»ã—ã€æ¶ˆå¤±ç‚¹è£œæ­£ã‚’å¤–ã—ã¦åˆ†å²åºŠãŒ slice2 ã‚ˆã‚Šæ‰‹å‰ã«å‡ºãªã„ã‚ˆã†èª¿æ•´ã€‚åˆ†å²ãƒ‘ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚’ç·©å’Œã—ã€ãƒ¡ã‚¤ãƒ³åºŠã®è¦‹é€šã—ã‚’å„ªå…ˆï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-27): FancyMazePreview junction/goal ã®æç”»é †ã‚’åºŠâ†’åˆ†å²åºŠâ†’å£â†’å‰å£ã«æ•´ç†ã—ã€åˆ†å²åºŠãŒå·¦å³ã®ãƒ¡ã‚¤ãƒ³å£ã‚„åˆ†å²å£ã®ä¸Šã«å¸¯çŠ¶ã«ã‹ã¶ã‚‰ãªã„ã‚ˆã†DOMé †ã‚’ä¿®æ­£ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã«DOMé †ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-28): FancyMazePreview junction/goal ã®åˆ†å²åºŠã‚’ anchor èµ·ç‚¹ã®çŸ­ã„å°å½¢ã«å†èª¿æ•´ã—ã€é æ–¹ã§ã‚ãšã‹ã«å¤–ã¸é€ƒãŒã™å´æ–¹ã‚·ãƒ•ãƒˆã‚’è¿½åŠ ã€‚goal ã§ã¯ãƒãƒ¼ã‚¿ãƒ«å…‰ã®åºŠã‚°ãƒ­ãƒ¼ã‚’é‡ã­ã€ãƒ†ã‚¹ãƒˆã« nearY>=anchorãƒ»farY<nearYãƒ»farXã®å¤–å‘ãã‚·ãƒ•ãƒˆã‚’ç¢ºèªã™ã‚‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-29): FancyMazePreview junction/goal ã®åˆ†å²åºŠ nearInner/nearOuter ã¨å†…å¤–å£ã®æ ¹å…ƒã‚’ slice2 ã‚¢ãƒ³ã‚«ãƒ¼(stop.y/left/right)ã«å³å¯†ã«æƒãˆã€near å´ã‚’ã‚¢ãƒ³ã‚«ãƒ¼æ·±åº¦ã«å›ºå®šã— far å´ã ã‘ BRANCH_DEPTH_DELTA ã§å¥¥è¡Œãã‚’å–ã‚‹ã‚ˆã†èª¿æ•´ã€‚branchMetrics ã§ anchorStop ã¨ã® nearY/X ä¸€è‡´ã¨å£æ ¹å…ƒã®åº§æ¨™ä¸€è‡´ã‚’æ¤œè¨¼ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-30): FancyMazePreview junction/goal ã§ slice å˜ä½ã®å£æ¬ æã‚’ã‚„ã‚ã€branch ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‹ã‚‰é–‹å£ãƒãƒªã‚´ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ mask ã‚’å·¦å³å£ã‚°ãƒ«ãƒ¼ãƒ—ã«é©ç”¨ã€‚é–‹å£ä½ç½®ã®æŸ±ã‚’ãªãã—ã€ãƒ†ã‚¹ãƒˆã‚’ãƒã‚¹ã‚¯å­˜åœ¨ã¨ mask å±æ€§æ¤œè¨¼ã«ç½®ãæ›ãˆï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx`ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-01-31): FancyMazePreview junction/goal ã® branch ãƒã‚¹ã‚¯ã‚’å£ã‚¹ãƒ©ã‚¤ã‚¹å½¢çŠ¶ã®éšæ®µãƒãƒªã‚´ãƒ³ã«ã—ã€data-branch-wall-mask-slice ã‚’ä»˜ä¸ã—ã¦ãƒ¡ã‚¤ãƒ³å£ã¨åŒã˜ãƒ‘ãƒ¼ã‚¹ã§ãã‚ŠæŠœãã€‚`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§ã‚¹ãƒ©ã‚¤ã‚¹å½¢çŠ¶ä¸€è‡´ã‚’æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-01): FancyMazePreview junction/goal ã® BRANCH_ANCHOR ã‚’ slice1 æ‰‹å‰ï¼ˆdepth 0.5ï¼‰ã«ç¹°ã‚Šä¸Šã’ã€é–‹å£ãƒã‚¹ã‚¯ã« slice1 ã‚’å«ã‚ã¦æ‰‹å‰ã®æŸ±ã‚’é™¤å»ã€‚å£ã‚¹ãƒ©ã‚¤ã‚¹å½¢çŠ¶ã®ãƒã‚¹ã‚¯ã¨ data-branch-wall-mask-slice ã¯ç¶­æŒã—ã¤ã¤ã€é–‹å£ãŒå‰ã‹ã‚‰æŠœã‘ã‚‹ã“ã¨ã‚’ `client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§ç¢ºèª
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-02): FancyMazePreview junction ã§æ­£é¢å£æç”»ã‚’å»ƒæ­¢ã—ã€forward=false æ™‚ã¯é»’ã„ã‚­ãƒ£ãƒƒãƒ—ã®ã¿ã§é–‰å¡ã‚’ç¤ºã™å°‚ç”¨æç”»ã«å¤‰æ›´ã€‚å·¦å³é–‹å£ã‚’åˆ†å²åºŠ/å£ã§å„ªå…ˆçš„ã«è¦‹ã›ã€`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§å‰å£éè¡¨ç¤ºã¨ã‚­ãƒ£ãƒƒãƒ—å­˜åœ¨ã‚’å›å¸°
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-03): FancyMazePreview junction ã«é–‹å£ãƒ•ã‚£ãƒ«(branch-opening-fill)ã‚’è¿½åŠ ã—ã€ãƒ¡ã‚¤ãƒ³å£ã®ç©´è¶Šã—ã«æš—ã„æ¨ªé€šè·¯é¢ãŒè¦‹ãˆã‚‹ã‚ˆã†æç”»é †ã‚’ åºŠâ†’åˆ†å²åºŠâ†’é–‹å£ãƒ•ã‚£ãƒ«â†’ãƒã‚¹ã‚¯â†’å£â†’åˆ†å²å£â†’ã‚­ãƒ£ãƒƒãƒ— ã«æ•´ç†ã€‚é–‹å£ãƒ•ã‚£ãƒ«ã¯ãƒã‚¹ã‚¯ã¨åŒã˜ã‚¹ãƒ©ã‚¤ã‚¹å½¢çŠ¶ãƒ»data-open-slice ã‚’æŒã¡ã€COLOR_BG ã«å£è‰²ã‚’ 0.3 æ··ãœãŸæš—è‰²ã§å¡—å¸ƒï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§é–‹å£ãƒ•ã‚£ãƒ«å­˜åœ¨ã¨å½¢çŠ¶ä¸€è‡´ã‚’æ¤œè¨¼ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-04): FancyMazePreview junction ã®åˆ†å²åºŠã«ãƒ¡ã‚¤ãƒ³åºŠã¨é€£ç¶šã™ã‚‹ã‚·ãƒ¼ãƒ ãƒãƒªã‚´ãƒ³ã‚’è¿½åŠ ã—ã€åºŠã®æ¶ˆå¤±ç·šã‚’é€”åˆ‡ã‚Œã•ã›ãšæ¨ªé€šè·¯ãŒè‡ªç„¶ã«ç”Ÿãˆã‚‹ã‚ˆã†èª¿æ•´ã€‚åˆ†å²å£ã¯ branch å´ã ã‘ã‚’ clipPath(data-role="branch-clip-*") ã§åˆ‡ã‚Šå‡ºã—ã€æœ¬ç·šæ‰‹å‰ã«é£Ÿã„è¾¼ã¾ãªã„ã‚ˆã† <g data-role="branch-walls-*> ã« clip-path ã‚’é©ç”¨ã€‚æç”»é †ã‚’ åºŠâ†’åºŠã‚¹ãƒ©ã‚¤ã‚¹â†’åˆ†å²åºŠâ†’ã‚·ãƒ¼ãƒ â†’é–‹å£ãƒ•ã‚£ãƒ«â†’defs(ãƒã‚¹ã‚¯/ã‚¯ãƒªãƒƒãƒ—)â†’ãƒ¡ã‚¤ãƒ³å£â†’ã‚¯ãƒªãƒƒãƒ—ä»˜ãåˆ†å²å£â†’ã‚­ãƒ£ãƒƒãƒ— ã«æ•´ç†ã—ã€`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§ã‚·ãƒ¼ãƒ ãƒ»ã‚¯ãƒªãƒƒãƒ—ã®å­˜åœ¨ã‚’æ¤œè¨¼
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-05): FancyMazePreview junction/goal ã® mouth ã«ã‚¤ãƒ³ã‚»ãƒƒãƒˆã‚’è¨­ã‘ã€nearInner ã‚’é€šè·¯å†…å´ã¸æŠ¼ã—è¾¼ã‚“ã§æ‰‹å‰ã‚¨ãƒƒã‚¸ã‚’ç·šåˆ†ã§æ¥ç¶šã€‚å†…å¤–å£ã®æ ¹å…ƒã‚’ nearInner/nearOuter ã«æƒãˆã€branch clip ã‚’åˆ†å²å´ã ã‘ã®å°å½¢ã«ç°¡ç•¥åŒ–ã—ã€ã‚·ãƒ¼ãƒ ã‚’ mainå†…å´â†’ã‚¢ãƒ³ã‚«ãƒ¼â†’branch nearOuterâ†’nearInner ã®4ç‚¹ã«æ•´ç†ï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§ mouth ã‚¤ãƒ³ã‚»ãƒƒãƒˆã¨å£æ ¹å…ƒãƒ»ã‚·ãƒ¼ãƒ ãƒ»ã‚¯ãƒªãƒƒãƒ—ã‚’æ¤œè¨¼ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-06): FancyMazePreview junction/goal ã® mouth ã‚¤ãƒ³ã‚»ãƒƒãƒˆã¨ã‚·ãƒ¼ãƒ ã‚’æ’¤å»ƒã—ã€ã‚¢ãƒ³ã‚«ãƒ¼ãƒ©ã‚¤ãƒ³ä¸Šã« mouthWidth=anchorWidth*0.12 ã®å…±æœ‰ã‚¨ãƒƒã‚¸ã‚’ç›´æ¥æãæ§‹æˆã«æˆ»ã™ã€‚åˆ†å²åºŠã®æ‰‹å‰2ç‚¹ã‚’ anchorStop ä¸Šã®ç·šåˆ†ã«æƒãˆã€branch-opening-fill ã¨ãƒã‚¹ã‚¯ã®ã¿ã‚’æ®‹ã—ã¦ clipPath ã‚’ç„¡åŠ¹åŒ–ã€‚åˆ†å²å£ã®æ ¹å…ƒã‚‚ mouth ç·šåˆ†ã«ä¸€è‡´ã•ã›ã€æç”»é †ã¯åºŠâ†’åºŠã‚¹ãƒ©ã‚¤ã‚¹â†’åˆ†å²åºŠâ†’é–‹å£ãƒ•ã‚£ãƒ«â†’defsâ†’ãƒ¡ã‚¤ãƒ³å£â†’åˆ†å²å£â†’cap ã«å›ºå®šï¼ˆ`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§åºŠé€£ç¶šæ€§ã¨å£æ ¹å…ƒãƒ»clipéä½¿ç”¨ã‚’æ¤œè¨¼ï¼‰
* æ›´æ–°ãƒ¡ãƒ¢(2026-02-07): FancyMazePreview junction/goal ã® BRANCH_ANCHOR ã‚’ slice1 æ·±åº¦(1.0)ã«æˆ»ã—ã€branch wall mask ã®é–‹å£ã‚¹ãƒ©ã‚¤ã‚¹ã‚’ slice2 ã®ã¿ã«åˆ¶é™ï¼ˆslice1 ã‚’å«ã‚ãªã„ï¼‰ã€‚åºŠç”¨ clipPath ã¯ anchorStop.y ã¨ mouthWidth ã«åˆã‚ã›ã¦å…±æœ‰ã‚¨ãƒƒã‚¸ã‚’ç¶­æŒã—ã€`client/src/views/FancyMazePreview.ts` / `client/tests/fancyMazePreview.test.tsx` ã§ mask ã‚¹ãƒ©ã‚¤ã‚¹é›†åˆã¨ã‚¯ãƒªãƒƒãƒ—ä½ç½®ã‚’å›å¸°

### 8.2 ã‚ªãƒ¼ãƒŠãƒ¼

* ä¿¯ç°å…¨ä½“ãƒãƒƒãƒ—ã€**ã‚ºãƒ¼ãƒ /ãƒ‘ãƒ³**ï¼ˆæœ€å°=è¿·è·¯å…¨ä½“, æœ€å¤§=9ãƒã‚¹ã‚’ç”»é¢å†…ï¼‰ã€‚åˆæœŸè¡¨ç¤ºã¯40Ã—40ã§ã‚‚å…¨åŸŸãŒæ¬ ã‘ãªã„ã‚ºãƒ¼ãƒ ï¼ˆç­‰å€ï¼‰ã§æç”»ã—ã€ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆè‡ªä½“ã‚‚ 480px è§’ã®å›ºå®šã‚µã‚¤ã‚ºã‚’ç¢ºä¿ã™ã‚‹ï¼ˆclient/src/views/OwnerView.tsx / client/tests/OwnerView.test.tsxï¼‰ã€‚
* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®ã®ãƒãƒ¼ã‚«ãƒ¼ã¯ **ã‚»ãƒ«ã‚’è¦†ã‚ãªã„å°å‹ã®ä¸Šå‘ãä¸‰è§’å½¢(â–²)** ã¨ã—ã€ç¦æ­¢è·é›¢ã‚µãƒ¼ã‚¯ãƒ«ã¨é‡ãªã£ã¦ã‚‚è¿·è·¯ã‚„ç½ /äºˆæ¸¬ã®è¦–èªæ€§ãŒæãªã‚ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚`client/tests/OwnerView.test.tsx` ã§SVGãƒãƒªã‚´ãƒ³ãƒ»è¾ºé•·ãŒ1ãƒã‚¹æœªæº€ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã€‚
* ãƒ­ãƒ“ãƒ¼ï¼ˆ`phase=lobby`ï¼‰ä¸­ã¯è¿·è·¯/HUDã‚’æç”»ã›ãšã€ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’æŠ¼ã™ã¨è¿·è·¯è‡ªå‹•è¨­è¨ˆã¨60ç§’ã®æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºãŒå§‹ã¾ã‚‹æ—¨ã‚’æ¡ˆå†…ã™ã‚‹ã€‚ãƒœã‚¿ãƒ³æŠ¼ä¸‹å¾Œï¼ˆ`countdown`/`prep`/`explore`ï¼‰ã®ã¿ä¿¯ç°ãƒãƒƒãƒ—ã¨åˆæœŸè¨­å®šHUDã‚’è¡¨ç¤ºã—ã€**ç½ æ¨©åˆ©/åŒæ™‚è¨­ç½®æ•°**ã€**ç¦æ­¢ã‚¨ãƒªã‚¢è·é›¢**ã€**ç·¨é›†ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ®‹ã‚Š**ã€**äºˆæ¸¬åœ°ç‚¹ã®æ®‹ã‚Šæ•°**ã€**è¨­å®šå¯èƒ½ãªæ®‹ã‚Šæ™‚é–“**ã ã‘ã«çµã‚‹ï¼ˆå£æ®‹æ•°ã‚„å¾—ç‚¹ã¯è¡¨ç¤ºã—ãªã„ï¼‰ã€‚ï¼ˆclient/src/views/OwnerView.tsx / client/tests/OwnerView.test.tsx / client/tests/AppPredictionIntegration.test.tsx / client/tests/AppOptimisticUi.test.tsx / client/tests/OwnerCooldownDisplay.test.tsx / client/tests/AppOwnerForbiddenDistance.test.tsxï¼‰ã€‚
* æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºä¸­ã¯HUDç›´ä¸‹ã« **ç½ ğŸª¤ / äºˆæ¸¬åœ°ç‚¹ğŸ¯ ã®é…ç½®ãƒ‘ãƒ¬ãƒƒãƒˆ**ã‚’è¡¨ç¤ºã—ã€ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆã¾ãŸã¯ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ã‘ã®ã‚¯ãƒªãƒƒã‚¯â†’ãƒãƒƒãƒ—ã‚¯ãƒªãƒƒã‚¯ï¼‰ã§é€šè·¯ä¸Šã«é…ç½®ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚ãƒ‰ãƒ­ãƒƒãƒ—æ™‚ã« `O_EDIT(PLACE_TRAP)` / `O_MRK` ã‚’é€ä¿¡ã—ã€è¨­ç½®å¾Œã¯è‡ªå‹•çš„ã«é¸æŠè§£é™¤ã€‚è¿·è·¯ãƒ‡ãƒ¼ã‚¿æœªå—ä¿¡ã‚„ãƒ•ã‚§ãƒ¼ã‚ºå¤–ã§ã¯ãƒ‘ãƒ¬ãƒƒãƒˆã‚’ç„¡åŠ¹åŒ–ã—ã€æ®‹ã‚Šæ™‚é–“å†…ã«ã€Œç½ 1å€‹ + äºˆæ¸¬åœ°ç‚¹3å€‹ã€ã®åˆæœŸç›®æ¨™ã‚’èª¬æ˜ã™ã‚‹ï¼ˆclient/src/views/OwnerView.tsx / client/tests/OwnerView.test.tsxï¼‰ã€‚
* ç·¨é›†ã¯**ç¢ºèªãƒãƒƒãƒ—â†’åŒã˜å ´æ‰€ã‚’å†ã‚¯ãƒªãƒƒã‚¯ã§ç¢ºå®š**ã€‚**å³ã‚¯ãƒªãƒƒã‚¯/Escã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«**ã€‚**1.0ç§’CD**ã€‚
* ãƒ­ãƒ“ãƒ¼ä¸­ã¯å‚åŠ çŠ¶æ³ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼/ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥å®¤å¯è¦–åŒ–ï¼‰ã¨ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥å®¤å¾Œã®ã¿æœ‰åŠ¹åŒ–ã—ã€æŠ¼ä¸‹ã§ `O_START` ã‚’é€ä¿¡ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’å§‹å‹•ã™ã‚‹ã€‚ãƒœã‚¿ãƒ³ç›´ä¸Šã«ã¯**è¿·è·¯ã‚µã‚¤ã‚ºé¸æŠï¼ˆ20Ã—20 / 40Ã—40ï¼‰**ç”¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é…ç½®ã—ã€ã‚ªãƒ¼ãƒŠãƒ¼ã¯é–‹å§‹æ™‚ã«å¸Œæœ›ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã§ãã‚‹ï¼ˆclient/tests/OwnerView.test.tsxï¼‰ã€‚
* æ¥ç¶šå¾Œã¯ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨ã«**ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ ID**ã‚’å¸¸æ™‚è¡¨ç¤ºã—ã€å–å¾—å‰ã¯ã€Œå–å¾—ä¸­ã€ã¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å‡ºã™ã€‚ã‚ªãƒ¼ãƒŠãƒ¼è‡ªèº«ãŒã‚³ãƒ¼ãƒ‰ã‚’å…±æœ‰ã§ãã‚‹ã‚ˆã† `client/tests/OwnerView.test.tsx` ã§DOMè¡¨ç¤ºã‚’æ¤œè¨¼ã™ã‚‹ã€‚
* è¿·è·¯è‡ªå‹•ç”Ÿæˆå®Œäº†å¾Œã¯ `STATE.snapshot.maze` ã§å—ä¿¡ã—ãŸã‚»ãƒ«/å£ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ä¿¯ç°ãƒãƒƒãƒ—ã¸å®Ÿéš›ã®å£ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æç”»ã—ã€ã‚¹ã‚¿ãƒ¼ãƒˆ/ã‚´ãƒ¼ãƒ«ã‚»ãƒ«ã‚’è–„ããƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã€‚è¿·è·¯ãƒ‡ãƒ¼ã‚¿æœªå—ä¿¡æ™‚ã¯ã€Œè¿·è·¯ç”Ÿæˆä¸­â€¦ã€ã®ä»£æ›¿è¡¨ç¤ºã¸åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼ˆclient/tests/OwnerView.test.tsx / server/tests/state-sync.test.tsï¼‰ã€‚

### 8.3 ã‚µã‚¦ãƒ³ãƒ‰

* SEã®ã¿ã€‚åˆæœŸéŸ³é‡70%ã€‚**å£/ç½ ã®è¦–ç•Œåæ˜ ã¯ç„¡æ¼”å‡ºå³æ™‚**ã€‚
* `SoundBus` ãŒå…¨SEã®éŸ³é‡ã‚’0ã€œ1ã§ã‚¯ãƒ©ãƒ³ãƒ—ç®¡ç†ã—ã€ãƒˆã‚°ãƒ«ã§ä¸€æ‹¬ãƒŸãƒ¥ãƒ¼ãƒˆãƒ»æœªç™»éŒ²IDå†ç”Ÿæ™‚ã¯è­¦å‘Šã®ã¿ã‚’å‡ºã™ã€‚

### 8.4 ãƒ‡ãƒãƒƒã‚°HUD

* `App` ä¸‹éƒ¨ã« `DebugHUD` ã‚’å¸¸è¨­ã—ã€**é€Ÿåº¦/è¦–ç•Œ/ã‚ºãƒ¼ãƒ å€ç‡/ç·¨é›†CD/ç¦æ­¢è·é›¢/è³‡æºä¸Šé™/ãƒã‚¤ãƒ³ãƒˆä¿‚æ•°/ç½ åŠ¹æœ**ãªã©ã®ä»•æ§˜å€¤ã¨ç¾åœ¨å€¤ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ã€‚ã‚ªãƒ¼ãƒŠãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ã¯ãƒ­ãƒ“ãƒ¼ï¼ˆ`phase=lobby`ï¼‰ä¸­ã®ã¿ãƒ˜ãƒƒãƒ€ãƒ¼å³ä¸Šã«ã€Œè¨­å®šã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã€æŠ¼ä¸‹ä¸­ã ã‘DebugHUDã‚’å±•é–‹ã™ã‚‹ã€‚`countdown` ä»¥é™ã‚„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ã¯ä¸€åˆ‡è¡¨ç¤ºã—ãªã„ï¼ˆclient/src/views/OwnerView.tsx / client/tests/OwnerView.test.tsx / client/tests/DebugHUD.test.tsx / client/src/ui/DebugHUD.tsxï¼‰ã€‚

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°/ãƒªã‚¸ã‚§ã‚¯ãƒˆç†ç”±

### 9.1 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆè¡¨ç¤ºï¼‰

* **ãƒˆãƒ¼ã‚¹ãƒˆ + èµ¤ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³**ï¼‹çŸ­æ–‡åŸå› ã€‚
* ä»£è¡¨ã‚³ãƒ¼ãƒ‰ï¼ˆ`ERR.code`ï¼‰ï¼š

  * `INVALID_NAME`ï¼ˆæ–‡å­—ç¨®/é•·ã•NGï¼‰
  * `INVALID_ROOM`ï¼ˆãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ä¸æ­£ï¼šBase32é¢¨6æ¡ã€ˆO/I/0/1é™¤å¤–ã€‰ã§ã¯ãªã„ï¼‰
  * `ROOM_NOT_FOUND` / `ROOM_FULL` / `ROOM_EXPIRED`
  * `DENY_EDIT`ï¼ˆç¦æ­¢ã‚¨ãƒªã‚¢/è³‡æºä¸è¶³/é‡ã­ä¸å¯ï¼‰
  * `TRAP_INVALID_CELL`ï¼ˆç½ ã‚’é€šè·¯ä¸­å¿ƒã«ç½®ã„ã¦ã„ãªã„ï¼‰
  * `NO_PATH`ï¼ˆçµŒè·¯ä¿è¨¼é•åï¼‰
  * `EDIT_COOLDOWN`ï¼ˆé€£ç¶šç·¨é›†ã€‚`data.remainingMs` ã§æ®‹ã‚ŠCDã‚’é€šçŸ¥ã€‚`server/tests/owner-edit-cooldown.test.ts` ã§æ¤œè¨¼æ¸ˆã¿ï¼‰
  * `LIMIT_REACHED`ï¼ˆäºˆæ¸¬/ç½ /æœ¬æ•°ä¸Šé™ï¼‰
  * `PHASE_LOCKED`ï¼ˆãƒ•ã‚§ãƒ¼ã‚ºå¤–æ“ä½œï¼‰
* è¡¨ç¤ºæ–‡è¨€ä¾‹ï¼š

  * `ROOM_FULL` â†’ ã€Œãƒ«ãƒ¼ãƒ ãŒæº€å“¡ã§ã™ã€‚åˆ¥ã®ãƒ«ãƒ¼ãƒ IDã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ã€
  * `INVALID_NAME` â†’ ã€Œãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãŒä¸æ­£ã§ã™ã€‚ä½¿ç”¨å¯èƒ½ãªæ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ã€
  * æœªå®šç¾©ã‚³ãƒ¼ãƒ‰ â†’ ã€Œä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚ã€
* ãƒˆãƒ¼ã‚¹ãƒˆã¯ç´„3.5ç§’ã§è‡ªå‹•æ¶ˆå¤±ã—ã€åŒæ™‚ã«è¤‡æ•°ä»¶ã‚’é‡ã­ã¦è¡¨ç¤ºã§ãã‚‹ã€‚

### 9.2 ã‚µãƒ¼ãƒå´ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ï¼‰

* **æ¤œè¨¼é †åº**ï¼ˆé‡è¦ï¼‰ï¼šPhaseâ†’å¯¾è±¡ç¯„å›²â†’è³‡æºâ†’é‡ãªã‚Šâ†’**çµŒè·¯BFS**â†’CDâ†’ç¢ºå®šâ†’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€‚
* ã™ã¹ã¦**ã‚µãƒ¼ãƒã§ç¢ºå®š**ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æ¥½è¦³æç”»ã›ãš**æ¨©å¨æ›´æ–°ã‚’å¾…ã¤**ã€‚
* åˆå›STATEã‚’å—ä¿¡ã™ã‚‹ã¾ã§ã¯ `App` ãŒã€Œæ¥ç¶šå¾…æ©Ÿä¸­ã€ãƒ“ãƒ¥ãƒ¼ã®ã¿ã‚’è¡¨ç¤ºã—ã€Owner/Playerãƒ“ãƒ¥ãƒ¼ã‚„HUDã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãªã„ã€‚
* ãƒ­ãƒ“ãƒ¼ç”»é¢ã§ã¯ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›ï¼ˆ2ã€œ10æ–‡å­—ã€è‹±æ•°ãƒ»ãƒã‚¤ãƒ•ãƒ³ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã€å…¥åŠ›æ™‚ã«å¤§æ–‡å­—ã¸æ­£è¦åŒ–ï¼‰ã¨ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆBase32é¢¨6æ¡ã§O/I/0/1ã‚’é™¤å¤–ï¼‰ã‚’æä¾›ã—ã€`POST /rooms`ï¼ˆHTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ `VITE_HTTP_ORIGIN` ã¾ãŸã¯ `VITE_WS_URL` ç”±æ¥ã® https åŒ–ï¼‰ã§æ–°è¦ãƒ«ãƒ¼ãƒ IDã‚’ç™ºè¡Œã—ã¦ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦æ¥ç¶šã™ã‚‹ã€‚æ—¢å­˜ãƒ«ãƒ¼ãƒ å‚åŠ ã¯å½¹å‰²ï¼ˆowner/playerï¼‰ãƒ©ã‚¸ã‚ªã‚’é¸æŠã—ã€ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãƒ»ã‚³ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ãªå ´åˆã®ã¿ `setRoom` ã‚’é€šã˜ã¦ WebSocket æ¥ç¶šã‚’é–‹å§‹ã™ã‚‹ã€‚HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è§£æ±ºã§ããªã„å ´åˆã¯ãƒ­ãƒ“ãƒ¼ã«è­¦å‘Šã‚’è¡¨ç¤ºã—ã€ãƒ«ãƒ¼ãƒ ä½œæˆãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦ç’°å¢ƒå¤‰æ•°è¨­å®šã‚’ä¿ƒã™ã€‚æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã¯ `INVALID_NAME` / `INVALID_ROOM`ã€é€šä¿¡å¤±æ•—ã¯ `NETWORK_ERROR` ãƒˆãƒ¼ã‚¹ãƒˆã§é€šçŸ¥ã™ã‚‹ã€‚

---

## 10. éæ©Ÿèƒ½/ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

* é¦–æç”»30fpsã€**ã‚µãƒ¼ãƒé€ä¿¡20Hz**ã€**STATEå·®åˆ†ã¯p95ã§2KBä»¥ä¸‹/ãƒ•ãƒ«STATEã¯20KBä»¥ä¸‹**ã‚’ç›®å®‰ã€‚
* ãƒ«ãƒ¼ãƒ åŒæ™‚æ¥ç¶š2åã€**ãƒãƒ¼ã‚ºä¸­ã‚‚Tickç¶™ç¶š**ï¼ˆæœ€å°åŒ–ï¼‰ã€‚
* **èµ·å‹•â†’ãƒ­ãƒ“ãƒ¼3ç§’ä»¥å†…**ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å¾Œï¼‰ã€‚**å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶**ï¼šæœ€æ–°Chrome/Edge/Firefoxã€‚

---

## 11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/å…¬å¹³æ€§

* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå…¥åŠ›ã¯**é€Ÿåº¦/å›è»¢ã®åˆ¶ç´„å†…**ã§ã‚µãƒ¼ãƒç©åˆ†ã€‚
* ä¸æ­£æ¤œçŸ¥ï¼šå…¥åŠ›ãƒ¬ãƒ¼ãƒˆä¸Šé™ã€**éå»æ™‚åˆ»tsæ‹’å¦**ï¼ˆç›´å‰ã‚ˆã‚Šå¤ã„ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ãƒªãƒ—ãƒ¬ã‚¤æ‰±ã„ã§ç ´æ£„ï¼‰ã€æœªæ¥æ™‚åˆ»è£œæ­£ã€ä½ç½®ã‚¹ãƒŠãƒƒãƒ—ï¼ˆè¿·è·¯å¢ƒç•Œå¤–/éæœ‰é™å€¤ã¯å†é…ç½®ã—ã€è¨±å®¹è·é›¢è¶…éã¯ç›´å‰åº§æ¨™ã¸ã‚¹ãƒŠãƒƒãƒ—ï¼‹è¨˜éŒ²ï¼‰ã€‚
* ã‚ªãƒ¼ãƒŠãƒ¼æ“ä½œã¯**1.0ç§’CD**ï¼‹ãƒ•ã‚§ãƒ¼ã‚º/ç¯„å›²æ¤œè¨¼ã€‚

---

## 12. è¨­å®š/ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

* ãƒ«ãƒ¼ãƒ ä½œæˆæ™‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼š

  * `sizeL`: 20|40ï¼ˆdefault 40ï¼‰
  * `timeLimitSec`: 300..600ï¼ˆdefault 300ï¼‰
* ãƒ“ãƒ«ãƒ‰æ™‚ç’°å¢ƒï¼š

  * `VITE_WS_URL`, `CF_ACCOUNT_ID`, `CF_WORKERS_API_TOKEN`, `CF_PAGES_API_TOKEN`, `CF_PAGES_PROJECT`, `SENTRY_DSN`ï¼ˆä»»æ„ï¼‰ãªã©ã€‚`VITE_WS_URL` ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–æ™‚ã®å¿…é ˆå€¤ã§ã€æœªè¨­å®šã ã¨ã‚¢ãƒ—ãƒªã®ãƒ­ãƒ¼ãƒ‰ãŒå³åº§ã«å¤±æ•—ã™ã‚‹ã€‚

---

## 13. å®Ÿè£…è¨ˆç”»ï¼ˆMVPâ†’æ‹¡å¼µï¼‰

1. **åŸºç›¤**ï¼šWSæ¥ç¶š/å†æ¥ç¶š, ãƒ«ãƒ¼ãƒ ç”Ÿæˆ/å…¥å®¤, STATEåŒæœŸ
2. **è¿·è·¯**ï¼šç”Ÿæˆï¼‹æœ€çŸ­è·¯ä¸‹é™åˆ¶ç´„ã€start/goalé…ç½®
3. **ç§»å‹•/è¦–ç•Œ**ï¼š20Hzç©åˆ†, ã‚¹ãƒ©ã‚¤ãƒ‰è£œæ­£, ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆæç”»
4. **è³‡æº/ç·¨é›†**ï¼šå£è¿½åŠ /å‰Šé™¤/ç½ , ç¢ºèª2ã‚¯ãƒªãƒƒã‚¯, CD, ç¦æ­¢/é‡ãªã‚Š/çµŒè·¯BFS
5. **ãƒã‚¤ãƒ³ãƒˆ/å‹æ•—**ï¼šé…ç½®UI, requiredè¨ˆç®—, ã‚´ãƒ¼ãƒ«ãƒœãƒ¼ãƒŠã‚¹, å³çµ‚äº†
6. **æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºæ¼”å‡º**ï¼šé€šè·¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆã‚´ãƒ¼ãƒ«å¿…ãšæ˜ ã‚‹ï¼‰
7. **åˆ‡æ–­/ãƒãƒ¼ã‚º/å¾©å¸°**
8. **éŸ³/HUD/ç´°éƒ¨UI**
9. **æœ€é©åŒ–/è² è·/è¨ˆæ¸¬/ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³**

---

## 14. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª/æŠ€è¡“è©³ç´°

```
/client
  /src
    /net (NetClient.ts, types.ts)
    /views (OwnerView.tsx, PlayerView.tsx, HUD.tsx)
    /game (Raycaster.ts, Physics.ts, Assets/, Sound.ts)
    /state (zustandç­‰)
    main.tsx
/server
  router.ts
  room-do.ts
  logic/ (maze.ts, rules.ts, validate.ts, bfs.ts)
  schema/ (ws.ts, state.ts)
  utils/ (rng.ts, id.ts, time.ts)
```

---

## 15. ãƒ‡ãƒ—ãƒ­ã‚¤/é‹ç”¨

* **ã‚µãƒ¼ãƒ**ï¼šCloudflare Workers + Durable Objects ã‚’æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã€‚ç¨¼åƒä¸­ã® WebSocket ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ `wss://meiro-server.minamidenshi.workers.dev/ws` ã§ã€æ¥ç¶šç¢ºèªãƒ­ã‚°ã‚’ `docs/deployment-log.md` ã«è¨˜éŒ²æ¸ˆã¿ã€‚
* **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆCloudflare Pages é™çš„ãƒ›ã‚¹ãƒˆï¼‰**ï¼š
  * Cloudflare Pages ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãƒªãƒã‚¸ãƒˆãƒªã® `client` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«è¨­å®šã€‚
  * Build Command=`npm run build --workspace @meiro/client`ã€Output Directory=`client/dist`ã€‚
  * åˆå›ãƒ“ãƒ«ãƒ‰ã®å‡ºåŠ›ï¼ˆä¾‹: `client/dist/index.html`ï¼‰ã¨è¨­å®šå†…å®¹ã¯ `docs/deployment-log.md` ã«è¨˜éŒ²ã—ã€å†ç¾æ‰‹é †ã‚’æ®‹ã—ã¦ã„ã‚‹ã€‚
  * ç’°å¢ƒå¤‰æ•° `VITE_WS_URL` ã« Cloudflare Workers ã® WebSocket ã‚ªãƒªã‚¸ãƒ³ `wss://meiro-server.minamidenshi.workers.dev` ã‚’è¨­å®šï¼ˆProduction/Preview ä¸¡æ–¹ã€‚è¨­å®šå†…å®¹ã¯ `docs/deployment-log.md` 2024-05-22 è¨˜éŒ²ã§è¿½è·¡ï¼‰ã€‚
  * GitHub é€£æºã§ Cloudflare Pages ã‚’æ§‹æˆã—ã€main/Pull Request ã”ã¨ã«è‡ªå‹•ãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤ãŒèµ°ã‚‹é‹ç”¨ã‚’æ¨å¥¨ã€‚
* **å‹•ä½œæ¤œè¨¼**ï¼šãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€Cloudflare Pages ä¸Šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ«ãƒ¼ãƒ ä½œæˆâ†’æ¥ç¶šâ†’ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»ã¾ã§ã‚’ç¢ºèªã—ã€å•é¡Œæ™‚ã¯ãƒ­ã‚°åé›†ï¼ˆå®Ÿæ–½ãƒ­ã‚°ã¯ `docs/deployment-log.md` 2024-05-23 è¨˜éŒ²ï¼‰ã€‚
* **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ï¼šREADME ãªã©ã®æ‰‹é †æ›¸ã« Cloudflare Pages + Cloudflare Workers ã®ä½µç”¨æ§‹æˆã‚’è¨˜è¼‰ã—ã€å†ç¾æ‰‹é †ãŒæ˜æ–‡åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆ`README.md` ã®ã€ŒCloudflare Pages + Cloudflare Workers ä½µç”¨ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã€ç¯€ã§æ‰‹é †/ç¢ºèªé …ç›®ã‚’åˆ—æŒ™ï¼‰ã€‚

* **ä¾å­˜**ï¼šReact, Phaser, zod(ã‚¹ã‚­ãƒ¼ãƒ), colyseus/protobufãªã—(JSONã§OK), vite, workers-typesã€‚
* **ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º**ï¼šJSONï¼ˆè¦ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–ï¼šçŸ­key/æ•°å€¤é…åˆ—ï¼‰ã€‚
* ãƒ«ãƒ¼ãƒˆã« `README.md` ã‚’ç½®ãã€ãƒ¢ãƒãƒ¬ãƒæ§‹æˆã¨ä¸»è¦ã‚³ãƒãƒ³ãƒ‰ã‚’è¨˜è¼‰ã€‚
* é…å¸ƒãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯ MITã€‚`LICENSE` ã¨ `NOTICE` ã‚’ãƒ«ãƒ¼ãƒˆã«é…ç½®ã—ã€è‘—ä½œæ¨©è¡¨è¨˜ã‚’æ˜ç¤ºã€‚
* ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ã¯ `main` ã‚’å®‰å®šãƒ–ãƒ©ãƒ³ãƒã¨ã—ã€`feature/*`ãƒ»`fix/*` ã‹ã‚‰PRçµŒç”±ã§å–ã‚Šè¾¼ã‚€ã€‚
* CI ã¯ `.github/workflows/ci.yml` ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ãƒ»Lintãƒ»Typecheckãƒ»Test ã‚’è‡ªå‹•å®Ÿè¡Œã€‚
* PRä½œæˆæ™‚ã¯ `.github/workflows/deploy-preview.yml` ã§ Cloudflare Workers/Pages ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿæ–½ã€‚`npm run lint` â†’ `npm run typecheck` â†’ `npm test` â†’ `npm run build --workspace @meiro/client` ã‚’çµŒã¦ã€`cloudflare/wrangler-action@3` ã§ `wrangler deploy --env preview` ã‚’å®Ÿè¡Œã—ã€ç¶šã‘ã¦ `cloudflare/pages-action@v1` ã§ `client/dist` ã‚’ Pages ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚å¿…è¦ãªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ `CF_ACCOUNT_ID`/`CF_WORKERS_API_TOKEN`/`CF_PAGES_API_TOKEN`/`CF_PAGES_PROJECT` ã‚’æƒ³å®šã€‚
* ãƒªãƒªãƒ¼ã‚¹ä½œæ¥­ã¯ `CHANGELOG.md` ã‚’æ›´æ–°ã—ã€`npm run format && npm run lint && npm run typecheck && npm test` ã‚’é€šã—ãŸã†ãˆã§ `git tag -a vX.Y.Z` ã‚’ç™ºè¡Œã— push ã™ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’ READMEã€Œãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼ã€ã«æ˜è¨˜ã™ã‚‹ã€‚ä½µã›ã¦ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã¨éå»ãƒªãƒªãƒ¼ã‚¹ä¿æŒæ–¹é‡ã‚‚ README ã«è¨˜è¼‰ã—ã€`packages/common/tests/release-process.test.ts` ã§ä¸¡æ–¹ã‚’æ¤œè¨¼ã€‚

---

## 15. ç–é€š/ã‚µãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼ï¼ˆæ™‚ç³»åˆ—ï¼‰

1. Owner: `POST /create` â†’ `roomId`å–å¾— â†’ WSæ¥ç¶š
2. Player: `roomId`å…¥åŠ› â†’ WSæ¥ç¶š
3. DOï¼š`LOBBYâ†’COUNTDOWN(3s)â†’PREP(60s)`ã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
4. Ownerï¼šãƒã‚¤ãƒ³ãƒˆé…ç½®â†’ç½ â†’äºˆæ¸¬ã€å„ç¢ºå®šã§`STATE`æ›´æ–°
5. Exploreé–‹å§‹ï¼šPlayerå…¥åŠ›`P_INPUT`ã‚’ã‚µãƒ¼ãƒç©åˆ†â†’ä½ç½®/ã‚¹ã‚³ã‚¢é…ä¿¡
6. Ownerç·¨é›†ï¼š`O_EDIT`â†’æ¤œè¨¼â†’ç¢ºå®šâ†’`STATE`é…ä¿¡
7. Playerè¦å®šåˆ°é”â†’`RESULT`é…ä¿¡â†’å†æˆ¦ãƒ•ãƒ­ãƒ¼

---

## 16. ãƒ­ã‚®ãƒ³ã‚°/è¨ˆæ¸¬/é‹ç”¨

* **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**ï¼šèµ·å‹•, æ¥ç¶š, Phaseé·ç§», æ“ä½œå¤±æ•—ï¼ˆERR.codeåˆ¥ï¼‰, RTT, FPSã€‚
* **ã‚µãƒ¼ãƒ**ï¼šéƒ¨å±‹å¯¿å‘½, å‚åŠ /é›¢è„±, Phaseæ™‚é–“, ç·¨é›†æ‹’å¦ç‡, BFSæ‰€è¦æ™‚é–“, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã€‚  
  * BFSæ¤œè¨¼ã¯ `owner.path_check` ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§è¨˜éŒ²ï¼ˆ`durationMs`, `blocked`, `checked`ï¼‰
* ã‚¢ãƒ©ãƒ¼ãƒˆï¼š**WSå¤±æ•—ç‡/å†æ¥ç¶šç‡/STATEé…å»¶>100ms**ï¼ˆ`client.ws.alert` / `client.ws.reconnect.alert` / `client.latency.alert` ã‚’ç™ºç«ï¼‰ã€‚
* **ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**ï¼š`client/src/logging/sentry.ts` ã§ Sentry ã‚’åˆæœŸåŒ–ã—ã€`VITE_SENTRY_DSN` æŒ‡å®šæ™‚ã®ã¿ `@sentry/browser` ã‚’æœ‰åŠ¹åŒ–ã€‚`client/tests/SentryInit.test.ts` ã§ DSN æœ‰ç„¡ã¨ä¾‹å¤–é€ä¿¡ã‚’æ¤œè¨¼ã€‚
* **ãƒ­ã‚°æ–¹é‡**ï¼šDurable Object ã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã¯ `console.info` / `console.warn` / `console.error` ã®ã¿ã«é™å®šã—ã€ãƒ¦ãƒ¼ã‚¶å…¥åŠ›ï¼ˆ`nick` ãªã©ã® PIIï¼‰ã‚’å«ã‚ãªã„ã€‚`packages/common/tests/logging-safety.test.ts` ã§é™çš„æ¤œæŸ»ã™ã‚‹ã€‚

---

## 17. ãƒ†ã‚¹ãƒˆè¨ˆç”»ï¼ˆå®Ÿè¡Œé †ï¼‰

### 17.1 ãƒ¦ãƒ‹ãƒƒãƒˆ

* `maze.generate(seed,L)`ï¼š**é€£çµæ€§**ã€**æœ€çŸ­è·¯â‰¥4Ã—L**ã€ãƒ©ãƒ³ãƒ€ãƒ ç¨®ã§**1,000å›**æ€§è³ªãƒ†ã‚¹ãƒˆï¼ˆProperty-Basedï¼‰ã€‚
* `rules.required(total)=ceil(0.65*total)` æ­£ç¢ºæ€§ã€‚
* `validate.edit`ï¼šç¦æ­¢ã‚¨ãƒªã‚¢/è³‡æº/é‡ãªã‚Š/çµŒè·¯BFS/ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆ`server/tests/owner-path-block.test.ts` ã§ç¦æ­¢è·é›¢ã¨çµŒè·¯ç¶­æŒã‚’æ‹…ä¿ï¼‰ã€‚
* `physics.integrate`ï¼šå£ã‚¹ãƒ©ã‚¤ãƒ‰/è§’æŠœã‘ã—ãªã„ï¼ˆ`packages/common/tests/physics.integrate.test.ts` ã§æ‹…ä¿ï¼‰ã€‚
* `trap.apply`ï¼šé‡è¤‡è¸ã¿å»¶é•·ï¼ˆ`server/tests/trap-apply.test.ts` ã§æ—¢å­˜slowUntilã¸ã®åŠ ç®—ã‚’æ¤œè¨¼ï¼‰ã€‚
* `points.lowerBoundè£œå¡«`ï¼šä¸Šé™=è¦å®šâˆ’1ã®ã‚¯ãƒªãƒƒãƒ—ï¼ˆ`server/tests/points-scoring.test.ts` ã§æ¤œè¨¼ï¼‰ã€‚

### 17.2 çµåˆ/ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

* **Bot**ï¼ˆPlayer/Ownerï¼‰ã§**5,000 Tick**é€£ç¶šå¯¾æˆ¦ï¼š

  * çµŒè·¯å°é–ã‚’**å¸¸ã«æ‹’å¦**ã§ãã‚‹ã“ã¨
  * äºˆæ¸¬åœ°ç‚¹é€šéâ†’è³‡æºãƒ©ãƒ³ãƒ€ãƒ ä»˜ä¸ã®**æ¯”ç‡åæŸï¼ˆ70/30Â±5%ï¼‰**
  * DEL_WALLã¯**1å›ã®ã¿**
* åˆ‡æ–­å†æ¥ç¶šï¼š60ç§’ä»¥å†…å¾©å¸°â†’ãƒãƒ¼ã‚ºè§£é™¤ã€è¶…éâ†’è¦å®šã®å‹æ•—é·ç§»ã€‚

### 17.3 è² è·/å®‰å®š

* 20ãƒ«ãƒ¼ãƒ åŒæ™‚ï¼ˆ40æ¥ç¶šï¼‰ã§**STATEé…å»¶p95â‰¤150ms**, ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸p95â‰¤2KBï¼ˆ`server/tests/state-latency-load.test.ts`ï¼‰ã€‚â€»è¿·è·¯ã‚’å«ã‚€åˆå›ãƒ•ãƒ«STATEã®ã¿ç´„20KBã€‚
* BFSæ¤œè¨¼p95â‰¤1ms/ç·¨é›†ã€‚
* é€£ç¶šç·¨é›†CDã®**ã‚µãƒ¼ãƒå¼·åˆ¶**ç¢ºèªã€‚

### 17.4 UX/å—å…¥ï¼ˆAcceptanceï¼‰

* ä»•æ§˜æ•°å€¤ï¼ˆé€Ÿåº¦/è¦–ç•Œ/HUD/ã‚ºãƒ¼ãƒ å€ç‡/ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³/ç¦æ­¢åŠå¾„/ä¸Šé™ä¸‹é™ï¼‰ãŒ**å…¨ã¦ç›®è¦–ç¢ºèª**ã§ãã‚‹ãƒ‡ãƒãƒƒã‚°HUDã€‚
* æº–å‚™ä¸­ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«**å¿…ãšã‚´ãƒ¼ãƒ«æ˜ åƒãŒå«ã¾ã‚Œã‚‹**ï¼ˆ3æšã®é™æ­¢ã‚¯ãƒªãƒƒãƒ—ã‚’5ç§’é–“éš”ã§è¡¨ç¤ºã—ã€ã‚´ãƒ¼ãƒ«ç›´å‰ã‚¯ãƒªãƒƒãƒ—ã‚’1å›å«ã‚ã‚‹ï¼‰ã€‚simpleMazePreview ã®ç°¡ç´ SVGã‚’æ¡ç”¨ã—ã€`client/tests/PlayerViewPreview.test.tsx` ã®ã‚¹ãƒ¢ãƒ¼ã‚¯ã§ prep ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„ã“ã¨ã®ã¿ç¢ºèªï¼ˆè©³ç´°ã‚¸ã‚ªãƒ¡ãƒˆãƒª/ãƒ‡ãƒ¼ã‚¿å±æ€§æ¤œè¨¼ã¯æ’¤å»ƒï¼‰ã€‚
* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã¯åœ°é¢ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚„2è‰²åºŠã‚’å»ƒã—ã€æš—ã„å£Ã—æ·¡ã„é€šè·¯ã®ãƒã‚¤ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã¨å‰æ–¹ã‚°ãƒ­ãƒ¼ã ã‘ã§é€šè·¯ã‚’æ˜ç­ã«ç¤ºã™ã€‚
* æ¢ç´¢ä¸­ãƒ“ãƒ¥ãƒ¼ã‚‚é»’èƒŒæ™¯ï¼‹å…¨ã¦èµ¤ç·š/èµ¤ãƒ‰ãƒƒãƒˆã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã§å¹¾ä½•å­¦çš„ã«è¡¨ç¤ºã—ã€Canvasãƒ¬ã‚¤ãƒ¤ãƒ¼ã ã‘ã§é€šè·¯ç«‹ä½“æ„Ÿã‚’å†ç¾ã™ã‚‹ã€‚
* ã‚´ãƒ¼ãƒ«åˆ°é”ï¼**å³çµ‚äº†ã§ã¯ãªã**è¦å®šæœªé”ãªã‚‰ç¶šè¡Œã—ã€**è¦å®šåˆ°é”ã§çµ‚äº†**ã€‚

---

## 18. æ—¢çŸ¥ã®æœªå®Ÿè£…/å°†æ¥é …ç›®

* è¦³æˆ¦/å±¥æ­´/çµ±è¨ˆ/ãƒªãƒ—ãƒ¬ã‚¤/ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«/ãƒ†ãƒ¼ãƒã‚¹ã‚­ãƒ³ï¼ˆå°†æ¥ï¼‰ã€‚

---

## 19. ãƒªã‚¹ã‚¯/è½ã¨ã—ç©´

* **çµŒè·¯BFSã®é »ç™º**ï¼šç·¨é›†é€£æ‰“æ™‚ã®è² è·ã€‚â†’ CD1.0sï¼‹**è¿‘å‚å·®åˆ†BFS**ï¼ˆ`RoomDurableObject` ãŒçµŒè·¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥/ãƒ–ãƒ­ãƒƒã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒã—ã€`server/tests/owner-path-block.test.ts` ã§ `owner.path_check.checked=false` ã‚’ç¢ºèªï¼‰ã§å±€æ‰€ãƒã‚§ãƒƒã‚¯æœ€é©åŒ–ã€‚
* **è¦–ç•Œãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆã®è² è·**ï¼šFOV90Â°Ã—ãƒ¬ã‚¤æ•°ã€‚â†’ æœ€å¤§90æœ¬/è·é›¢4ãƒã‚¹ã§æ‰“ã¡åˆ‡ã‚Šï¼ˆ`client/tests/Raycaster.test.ts`ï¼‰ã€‚
* **åˆ‡æ–­å‡¦ç†**ï¼šãƒ–ãƒ©ã‚¦ã‚¶é–‰ã˜/ã‚¹ãƒªãƒ¼ãƒ—å¤šç™ºã€‚â†’ ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆï¼‹**ã‚µãƒ¼ãƒå´60ç§’ã‚¿ã‚¤ãƒãƒ¼**ï¼ˆ`server/tests/disconnect-timeout.test.ts` / `server/tests/heartbeat-timeout.test.ts`ï¼‰ã€‚

---

## 20. é–‹ç™ºãƒ»å‹•ä½œæ‰‹é †ï¼ˆæœ€å°å†ç¾ï¼‰

```bash
# client
npm run dev --workspace @meiro/client    # http://localhost:5173
# server (wrangler)
npm install --workspace @meiro/server
npm run dev --workspace @meiro/server -- --local
```

* .envï¼ˆä¾‹ï¼‰

* `VITE_WS_URL=ws://127.0.0.1:8787`
  * `NODE_ENV=development`
* `wrangler.toml` ã¯ãƒ™ãƒ¼ã‚¹è¨­å®šã«åŠ ãˆã¦ `env.local` / `env.dev` / `env.preview` / `env.prod` ã‚’æŒã¡ã€ç’°å¢ƒã”ã¨ã® `name` / ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° or `workers_dev` / `WS_ORIGIN` / `ENVIRONMENT` ã‚’å®šç¾©ï¼ˆ`server/tests/wrangler-config.test.ts`ï¼‰

---

## 21. å—ã‘å…¥ã‚Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆæŠœç²‹ï¼‰

* [x] ãƒ­ãƒ“ãƒ¼5åˆ†è‡ªå‹•è§£æ•£
* [x] ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³3s â†’ æº–å‚™(40/5/15)å›ºå®šï¼ˆ`server/tests/prep-phase-windows.test.ts`ï¼‰
* [x] 20Ã—20/40Ã—40ã€**æœ€çŸ­â‰¥4Ã—L**ï¼ˆ`server/tests/room-maze-initialization.test.ts`ï¼‰
* [x] è¦–ç•Œï¼šFOV90Â°, åˆ°é”4ãƒã‚¹ï¼ˆ4ãƒã‚¹ç›®æ¸›å…‰ï¼‰ï¼‹è¿·è·¯ã‚»ãƒ«ã‚’2å€æ ¼å­ã«æŠ•å½±ã—ã¦ASCIIãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã¨åºŠ/å£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‹•çš„æç”»ã—ã€4ãƒã‚¹ä»¥é ã¯é»’ãƒ•ã‚©ã‚°ã§é®å…‰ï¼†é–‰ã˜ãŸå£é¢ã«ã¯ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ã‚’æãï¼ˆ`client/tests/PlayerViewRaycaster.test.tsx`ï¼‰
* [x] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ“ãƒ¥ãƒ¼ï¼šæ­£é¢æ–¹å‘ã®ã¿ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã«å¥¥è¡Œãã‚’åæ˜ ã—ã€dead-end / corner / junction åˆ¤å®šã‚’ `dataset` ã¨æç”»ã§æç¤ºï¼ˆ`client/tests/PlayerViewRaycaster.test.tsx` è¿½åŠ ãƒ†ã‚¹ãƒˆï¼‰
* [x] ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼šsimpleMazePreview ã«ã‚ˆã‚‹ prep ã‚¹ãƒ¢ãƒ¼ã‚¯ï¼ˆåºŠ/å£/ç©ºã®ç°¡ç´ SVGã€‚è©³ç´°ã‚¸ã‚ªãƒ¡ãƒˆãƒªæ¤œè¨¼ã¯æ’¤å»ƒã€`client/tests/PlayerViewPreview.test.tsx`ï¼‰
* [x] å£ï¼šåˆæœŸæœ¬æ•°ã€å‰Šé™¤1å›ã€CD1.0sã€ç¦æ­¢åŠå¾„2ã€çµŒè·¯ç¶­æŒï¼ˆ`server/tests/owner-resources.test.ts` / `server/tests/owner-path-block.test.ts` / `client/tests/OwnerView.test.tsx` / `client/tests/DebugHUD.test.tsx` / `client/tests/AppOwnerForbiddenDistance.test.tsx`ï¼‰
* [x] ç½ ï¼š40%é€Ÿåº¦ã€limit/5ã€åŒæ™‚2
* [x] ãƒã‚¤ãƒ³ãƒˆï¼šä¸‹é™ä¸è¶³â†’åˆæœŸãƒã‚¤ãƒ³ãƒˆè£œå¡«ï¼ˆä¸Šé™=è¦å®šâˆ’1ï¼‰
* [x] è¦å®š=ceil(0.65Ã—åˆè¨ˆ)ã€ã‚´ãƒ¼ãƒ«+è¦å®š1/5ã€**è¦å®šåˆ°é”ã§çµ‚äº†**ï¼ˆ`server/tests/points-scoring.test.ts`ï¼‰
* [x] åˆ‡æ–­â†’å³ãƒãƒ¼ã‚ºâ†’60ç§’å‹æ•—
* [x] 30fps/20Hz/é…å»¶100msä»¥ä¸‹ï¼ˆ`client/tests/FrameLoop.test.tsx` / `server/tests/outbound-rate-limit.test.ts` / `client/tests/NetClientLatency.test.ts` / `server/tests/metrics-alerts.test.ts`ï¼‰

---

## 22. å¤‰æ›´å®¹æ˜“æ€§ã®ãŸã‚ã®è¨­è¨ˆãƒãƒ¼ãƒˆ

* **ãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯**ï¼šå…¨ä¿‚æ•°ã¯`rules`ã«é›†ç´„ï¼ˆA/Bã‚„ã‚¤ãƒ™ãƒ³ãƒˆã§å·®ã—æ›¿ãˆå¯ï¼‰ã€‚
* **ã‚¹ãƒ†ãƒ¼ãƒˆåˆ†é›¢**ï¼š`Room`/`Maze`/`OwnerState`/`PlayerState`/`Rules`ã‚’ç–ã«ã€‚
* **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¾Œæ–¹äº’æ›**ï¼š`t`/`op`ã®åˆ—æŒ™æ‹¡å¼µã€æœªçŸ¥ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ç„¡è¦–ã€‚

---

## 23. ä»˜è¨˜ï¼šä¸ç¢ºå®Ÿç‚¹ã¨ä»®å®š

* ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ãƒˆå®Ÿè£…ã¯**Phaserä¸Šã®è‡ªå‰**ã¨ã—ã€ã‚·ã‚§ãƒ¼ãƒ€ã¯å¿…é ˆã§ã¯ãªã„ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¬¡ç¬¬ã§æœ€é©åŒ–ï¼‰ã€‚
* JSONåœ§ç¸®ã¯**ã¾ãšä¸è¦**ã€ã‚µã‚¤ã‚ºä¸Šé™å†…ã§é‹ç”¨ã€‚
* ç½ æŒç¶šã®ã€Œåˆ¶é™æ™‚é–“ã€ã¯**ãƒ©ã‚¦ãƒ³ãƒ‰è¨­å®šæ™‚é–“**ã«ä¾å­˜ï¼ˆä¾‹ï¼š5åˆ†â†’60ç§’ï¼‰ã¨ã—ã¦å®Ÿè£…ã€‚

---

**æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã™ãå§‹ã‚ã‚‹ï¼‰**

1. `RoomDO`ã®é››å½¢ã¨20Hzãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆï¼ˆSTATEã‚¹ã‚±ãƒ«ãƒˆãƒ³é…ä¿¡ï¼‰ã€‚
2. è¿·è·¯ç”Ÿæˆï¼‹BFSãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ1,000ã‚±ãƒ¼ã‚¹ï¼‰ã€‚
3. Playerç§»å‹•/è¡çª/è¦–ç•Œã®MVP â†’ Ownerç·¨é›†ã®MVP â†’ å‹æ•—å‡¦ç†ã€‚

ä¸æ˜ç‚¹ãŒå‡ºãŸã‚‰ã€ä¸Šè¨˜ä»•æ§˜ã®ã€Œå—å…¥ã‚Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€ã«ç…§ã‚‰ã—ã¦åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚


Medical References:
1. None â€” DOI: file-KpXCKMcQWrqAEiT6RG2RjV
